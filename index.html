<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-25年前中央电视台广告报价" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/02/06/25%E5%B9%B4%E5%89%8D%E4%B8%AD%E5%A4%AE%E7%94%B5%E8%A7%86%E5%8F%B0%E5%B9%BF%E5%91%8A%E6%8A%A5%E4%BB%B7/" class="article-date">
  <time class="dt-published" datetime="2025-02-06T05:41:40.000Z" itemprop="datePublished">2025-02-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/02/06/25%E5%B9%B4%E5%89%8D%E4%B8%AD%E5%A4%AE%E7%94%B5%E8%A7%86%E5%8F%B0%E5%B9%BF%E5%91%8A%E6%8A%A5%E4%BB%B7/">25年前中央电视台广告报价</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><strong>中国中央电视台一套广告价目表</strong></p>
<p><a target="_blank" rel="noopener" href="http://www.cctv.com/profile/adver/guang5.html">http://www.cctv.com/profile/adver/guang5.html</a></p>
<p><strong>2001年1月1日起执行</strong> <strong>单位：人民币元</strong></p>
<table>
<thead>
<tr>
<th><strong>分类</strong></th>
<th><strong>播出时间</strong></th>
<th><strong>广告长度每次</strong></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>5秒</td>
<td>10秒</td>
<td>15秒</td>
<td>20秒</td>
<td>25秒</td>
<td>30秒</td>
<td></td>
<td></td>
</tr>
<tr>
<td>白天4</td>
<td>13:55</td>
<td>4200</td>
<td>6400</td>
<td>8000</td>
<td>10900</td>
<td>12800</td>
<td>14000</td>
</tr>
<tr>
<td>少儿节目</td>
<td>18:05</td>
<td>7000</td>
<td>10000</td>
<td>13000</td>
<td>18000</td>
<td>21000</td>
<td>23000</td>
</tr>
<tr>
<td>榜上有名</td>
<td>19:00前</td>
<td>20000</td>
<td>30000</td>
<td>38000</td>
<td>52000</td>
<td>61000</td>
<td>68000</td>
</tr>
<tr>
<td>A</td>
<td>19:52</td>
<td></td>
<td></td>
<td>90000</td>
<td></td>
<td></td>
<td>180000</td>
</tr>
<tr>
<td>B1</td>
<td>20:01</td>
<td>40000</td>
<td>56000</td>
<td>70000</td>
<td>95000</td>
<td>110000</td>
<td>126000</td>
</tr>
<tr>
<td>B2</td>
<td>20:55</td>
<td>27000</td>
<td>40000</td>
<td>50000</td>
<td>68000</td>
<td>80000</td>
<td>90000</td>
</tr>
<tr>
<td>C</td>
<td>21:20</td>
<td>24000</td>
<td>36000</td>
<td>45000</td>
<td>61000</td>
<td>72000</td>
<td>81000</td>
</tr>
<tr>
<td>D</td>
<td>21:55</td>
<td>20000</td>
<td>30000</td>
<td>38000</td>
<td>52000</td>
<td>61000</td>
<td>68000</td>
</tr>
<tr>
<td>E1</td>
<td>22:45</td>
<td>10000</td>
<td>16000</td>
<td>20000</td>
<td>27000</td>
<td>32000</td>
<td>36000</td>
</tr>
<tr>
<td>E2</td>
<td>22:49</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>F</td>
<td>23:00后</td>
<td>7000</td>
<td>9600</td>
<td>12000</td>
<td>16000</td>
<td>19000</td>
<td>21600</td>
</tr>
</tbody></table>
<p>中央电视台栏目广告价目表CCTV-1</p>
<table>
<thead>
<tr>
<th>栏目名称</th>
<th>播出时间</th>
<th>长度（秒）</th>
<th>广告价格</th>
</tr>
</thead>
<tbody><tr>
<td>收视指南1（有声）</td>
<td>19:00前</td>
<td>5</td>
<td>30000</td>
</tr>
<tr>
<td>收视指南1（无声）</td>
<td>19:00前</td>
<td>5</td>
<td>20000</td>
</tr>
<tr>
<td>收视指南2</td>
<td>20:00</td>
<td>5</td>
<td>40000</td>
</tr>
<tr>
<td>收视指南3</td>
<td>21:09</td>
<td>5</td>
<td>24000</td>
</tr>
<tr>
<td>飞天奖片头后</td>
<td>20:05</td>
<td>5</td>
<td>40000</td>
</tr>
<tr>
<td></td>
<td></td>
<td>15</td>
<td>75000</td>
</tr>
<tr>
<td>电视剧贴片</td>
<td>20:06</td>
<td>15</td>
<td>80000</td>
</tr>
<tr>
<td>科技博览</td>
<td>19:55</td>
<td>5</td>
<td>48000</td>
</tr>
<tr>
<td>世界报道后</td>
<td>22:10</td>
<td>5</td>
<td>24000</td>
</tr>
<tr>
<td></td>
<td></td>
<td>15 30</td>
<td>45000 81000</td>
</tr>
<tr>
<td>晚间新闻后</td>
<td>22:22</td>
<td>5</td>
<td>24000</td>
</tr>
<tr>
<td></td>
<td></td>
<td>15 30</td>
<td>45000 81000</td>
</tr>
<tr>
<td>综艺大观</td>
<td>周六20:10</td>
<td>15</td>
<td>80000</td>
</tr>
<tr>
<td>曲苑杂谈</td>
<td>周六20:10</td>
<td>15</td>
<td>80000</td>
</tr>
<tr>
<td>东西南北中</td>
<td>周六20:10</td>
<td>15</td>
<td>80000</td>
</tr>
</tbody></table>
<p>说明：<br>　　1.凡在我台办理电视广告业务，一律执行先交费，后播出的原则。 　<br>　　2.与我部签订广告播出合同时，广告公司需提供所代理客户的营业执照、商标注册证、生产许可证，其中药品、化妆品、医疗器械、食品应按广告法规及国家有关部门的具体规定办理。广告代理公司同时还应持有客户签字并加盖公章的委托书正本或与客户签订的合同。<br>　　3.法定节假日广告费加收20%，其中包括：四月三十日，五月一、二、三日，九月三十日，十月一、二、三日，十二月三十一日，一月一日。<br>　　4.栏目广告价格在相应的段位价格基础上加收40%。<br>　　5.各段广告，指定正一和倒一加收20%，正二和倒二加收16%，正三和倒三加收12%，正四和倒四加收8%，正五和倒五加收5%。<br>　　6.遇重大节目及特殊宣传活动，广告价格及指定位置加价比例另行制定。<br>　　7.因重大节目或特殊宣传活动，导致正常时段广告随节目提前或顺延60分钟以内播出的，不予补偿。<br>　　8.签定距播出日60天以上的播出合同，可先交纳定金，定金为合同金额的5%，余款应在距离播出日30天以前付清，过期未付清款项的，播出合同将被计算机自动删除，定金不予返还。在播出前30天内要求停播的，退款50%，十日内要求停播的，不予退款。<br>　　9.酒类广告价格在原价格基础上加收10%。（不享受其他优惠政策）<br>　　10.以集群形式播出的广告，30秒广告限产品6个，15秒广告限产品3个，广告价格在原时段广告价格的基础上加收70%。<br>　　11.广告带必须提前15天送到广告部，并签定版本合同，如因未签定版本合同造成的错播、陋播等事故，我部不承担任何责任。<br>　　12.广告公司提供的广告带在播出后如发生版权等纠纷，我部不承担任何责任。<br>　　13.本价目表从2001年一月一日起执行，以前印制的中国中央电视台电视广告价目表和说明停止使用。</p>
<p><strong>中国中央电视台二套广告价目表</strong></p>
<p><a target="_blank" rel="noopener" href="http://www.cctv.com/profile/adver/adcctv2.html">http://www.cctv.com/profile/adver/adcctv2.html</a></p>
<p><strong>2000年12月1日起执行　　　　*<em>单位：人民币元*</em></strong></p>
<table>
<thead>
<tr>
<th>广告时段</th>
<th>时间</th>
<th>5秒</th>
<th>10秒</th>
<th>15秒</th>
<th>20秒</th>
<th>25秒</th>
<th>30秒</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>A</td>
<td>19:30</td>
<td>11000</td>
<td>16000</td>
<td>20000</td>
<td>27000</td>
<td>32000</td>
<td>36000</td>
<td></td>
</tr>
<tr>
<td>B</td>
<td>20:35</td>
<td>11000</td>
<td>16000</td>
<td>20000</td>
<td>27000</td>
<td>32000</td>
<td>36000</td>
<td>周六20:10,周日20:05</td>
</tr>
<tr>
<td>C</td>
<td>21:25</td>
<td>11000</td>
<td>16000</td>
<td>20000</td>
<td>27000</td>
<td>32000</td>
<td>36000</td>
<td>周六20:50,周日20:40</td>
</tr>
<tr>
<td>E</td>
<td>22:35</td>
<td>6000</td>
<td>9600</td>
<td>12000</td>
<td>16000</td>
<td>19000</td>
<td>22000</td>
<td>周五23:35、周六22:45、周日23:15</td>
</tr>
<tr>
<td>F</td>
<td>23:10</td>
<td>5000</td>
<td>8000</td>
<td>10000</td>
<td>14000</td>
<td>16000</td>
<td>18000</td>
<td>周五、周日无,周六23:50</td>
</tr>
<tr>
<td>G</td>
<td>23:45</td>
<td>5000</td>
<td>8000</td>
<td>10000</td>
<td>14000</td>
<td>16000</td>
<td>18000</td>
<td>周五、周六、周日无</td>
</tr>
<tr>
<td>正大剧场前</td>
<td>20:45</td>
<td></td>
<td></td>
<td>30000</td>
<td></td>
<td></td>
<td>54000</td>
<td></td>
</tr>
<tr>
<td>正大剧场1</td>
<td>21:10</td>
<td></td>
<td></td>
<td>38000</td>
<td></td>
<td></td>
<td>68400</td>
<td></td>
</tr>
<tr>
<td>正大剧场2</td>
<td>21:35</td>
<td></td>
<td></td>
<td>38000</td>
<td></td>
<td></td>
<td>68400</td>
<td></td>
</tr>
<tr>
<td>证券之夜</td>
<td></td>
<td>8000</td>
<td>12000</td>
<td>15000</td>
<td>20000</td>
<td>24000</td>
<td>26000</td>
<td>周一至周四22:05、周五23:05</td>
</tr>
<tr>
<td>证券时间</td>
<td></td>
<td>3600</td>
<td>5500</td>
<td>6800</td>
<td>9200</td>
<td>10800</td>
<td>12000</td>
<td>周一至周五09:15、15:00</td>
</tr>
<tr>
<td>地球故事</td>
<td></td>
<td>11000</td>
<td>16000</td>
<td>20000</td>
<td>27000</td>
<td>32000</td>
<td>36000</td>
<td>首播：周一至周五21:00 重播14:00</td>
</tr>
<tr>
<td>为您服务</td>
<td></td>
<td>5300</td>
<td>8000</td>
<td>10000</td>
<td>13600</td>
<td>16000</td>
<td>18000</td>
<td>首播：周一至周五18:00 重播：周一至周四23:50,周五00:40</td>
</tr>
<tr>
<td>经济节目导视</td>
<td></td>
<td>13800</td>
<td>220800</td>
<td>261630</td>
<td></td>
<td></td>
<td></td>
<td>周价格（每周播出不少于70次）</td>
</tr>
<tr>
<td>信息节目导视</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>周价格（每周播出不少于45次）</td>
</tr>
</tbody></table>
<p>说明：<br>　　1.凡在我台办理电视广告业务，一律执行先交费，后播出的原则。 　<br>　　2.与我部签订广告播出合同时，广告公司需提供所代理客户的营业执照、商标注册证、生产许可证，其中药品、化妆品、医疗器械、食品应按广告法规及国家有关部门的具体规定办理。广告代理公司同时还应持有客户签字并加盖公章的委托书正本或与客户签订的合同。<br>　　3.法定节假日广告费加收20%，其中包括：四月三十日，五月一、二、三日，九月三十日，十月一、二、三日，十二月三十一日，一月一日。<br>　　4.栏目广告价格在相应的段位价格基础上加收40%。<br>　　5.各段广告，指定正一和倒一加收20%，正二和倒二加收16%，正三和倒三加收12%，正四和倒四加收8%，正五和倒五加收5%。<br>　　6.遇重大节目及特殊宣传活动，广告价格及指定位置加价比例另行制定。<br>　　7.因重大节目或特殊宣传活动，导致正常时段广告随节目提前或顺延60分钟以内播出的，不予补偿。<br>　　8.签定A段、整月、隔日半月、前后半月播出方式以外的零散合同加价5%。<br>　　9.签定二套、三套、四套、七套的广告播出合同，广告次数以周为单位计算，栏目广告除外。<br>　　10.签定距播出日60天以上的播出合同，可先交纳定金，定金为合同金额的5%，余款应在距离播出日30天以前付清，过期未付清款项的，播出合同将被计算机自动删除，定金不予返还。在播出前30天内要求停播的，退款50%，十日内要求停播的，不予退款。<br>　　11.酒类广告价格在原价格基础上加收10%。（不享受其他优惠政策）<br>　　12.以集群形式播出的广告，30秒广告限产品6个，15秒广告限产品3个，广告价格在原时段广告价格的基础上加收60%。<br>　　13.广告带必须提前15天送到广告部，并签定版本合同，如因未签定版本合同造成的错播、陋播等事故，我部不承担任何责任。<br>　　14.广告公司提供的广告带在播出后如发生版权等纠纷，我部不承担任何责任。<br>　　15.本价目表从二000年十二月一日起执行，以前印制的中国中央电视台电视广告价目表和说明停止使用。</p>
<p><strong>中国中央电视台三套广告价格</strong></p>
<p><a target="_blank" rel="noopener" href="http://www.cctv.com/profile/adver/adcctv3.html">http://www.cctv.com/profile/adver/adcctv3.html</a></p>
<p><strong>2001年1月1日起执行</strong></p>
<table>
<thead>
<tr>
<th>播出时间</th>
<th>5秒</th>
<th>15秒</th>
<th>30秒</th>
</tr>
</thead>
<tbody><tr>
<td>8:45</td>
<td>2100</td>
<td>4000</td>
<td>7200</td>
</tr>
<tr>
<td>13:10</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>14:55</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>17:55</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>21:15</td>
<td>4800</td>
<td>9000</td>
<td>16000</td>
</tr>
</tbody></table>
<p><strong>中国中央电视台四套广告价格</strong></p>
<p><a target="_blank" rel="noopener" href="http://www.cctv.com/profile/adver/adcctv4.html">http://www.cctv.com/profile/adver/adcctv4.html</a></p>
<p><strong>2001年1月1日起执行</strong></p>
<table>
<thead>
<tr>
<th>播出时间</th>
<th>5秒</th>
<th>15秒</th>
<th>30秒</th>
</tr>
</thead>
<tbody><tr>
<td>7:00</td>
<td>4200</td>
<td>8000</td>
<td>14000</td>
</tr>
<tr>
<td>9:00</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>10:15</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>14:00</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>14:55</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>17:55</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>22:00</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>02:30</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><strong>中国中央电视台五套</strong></p>
<p><a target="_blank" rel="noopener" href="http://www.cctv.com/profile/adver/adcctv5.html">http://www.cctv.com/profile/adver/adcctv5.html</a></p>
<p><strong>2001年1月1日起执行</strong></p>
<p><strong>时段广告价格（元&#x2F;次）</strong></p>
<table>
<thead>
<tr>
<th>时段</th>
<th>播出时间</th>
<th>5秒</th>
<th>15秒</th>
<th>30秒</th>
</tr>
</thead>
<tbody><tr>
<td>A</td>
<td>18：00-19：00期间</td>
<td>5300</td>
<td>9900</td>
<td>17800</td>
</tr>
<tr>
<td>B</td>
<td>21：00-22：00期间</td>
<td>6400</td>
<td>12000</td>
<td>21600</td>
</tr>
<tr>
<td>C</td>
<td>22：00-23：00期间</td>
<td>4400</td>
<td>8300</td>
<td>15000</td>
</tr>
<tr>
<td>D</td>
<td>23：00以后</td>
<td>3300</td>
<td>6200</td>
<td>11000</td>
</tr>
<tr>
<td>白天时段</td>
<td>6：00-18：00</td>
<td>1600</td>
<td>3000</td>
<td>5400</td>
</tr>
</tbody></table>
<p>时段全天套装方案：<br>播出安排：每天播出白天3次（早间、午间、下午各一次）、晚间3次（B、C、D段中各一次）<br><strong>价格：</strong></p>
<table>
<thead>
<tr>
<th>项目</th>
<th>5秒</th>
<th>15秒</th>
<th>30秒</th>
</tr>
</thead>
<tbody><tr>
<td>月套（4周168次）</td>
<td>320000</td>
<td>590000</td>
<td>1062000</td>
</tr>
<tr>
<td>季套（13周546次）</td>
<td>760000</td>
<td>1430000</td>
<td>2574000</td>
</tr>
<tr>
<td>半年套（26周1092次）</td>
<td>1220000</td>
<td>2288000</td>
<td>4120000</td>
</tr>
</tbody></table>
<p>备注：时段以两周为最小签约单位；时段套价格为一次性付款价格，半年套执行期为2001年1月1日-6月30日；</p>
<p><strong>专题类栏目广告价格（元&#x2F;次）</strong></p>
<table>
<thead>
<tr>
<th>栏目</th>
<th>播出安排</th>
<th>5秒</th>
<th>15秒</th>
<th>30秒</th>
</tr>
</thead>
<tbody><tr>
<td>《天下足球》</td>
<td>周一20：00</td>
<td>11800</td>
<td>22000</td>
<td>39600</td>
</tr>
<tr>
<td>《足球之夜》</td>
<td>周四20：00</td>
<td>13900</td>
<td>26000</td>
<td>46800</td>
</tr>
<tr>
<td>《五环夜话》</td>
<td>周二20：30</td>
<td>9600</td>
<td>18000</td>
<td>32400</td>
</tr>
<tr>
<td>NBA</td>
<td>周五19：30</td>
<td>12000</td>
<td>22500</td>
<td>40500</td>
</tr>
</tbody></table>
<p><strong>新闻类栏目广告价格（元&#x2F;次）</strong></p>
<table>
<thead>
<tr>
<th>《体坛快讯》</th>
<th>周一至日12：00</th>
<th>4800</th>
<th>9000</th>
<th>16200</th>
</tr>
</thead>
<tbody><tr>
<td>《体育新闻》</td>
<td>周一至日18：00</td>
<td>7700</td>
<td>14500</td>
<td>26100</td>
</tr>
<tr>
<td>《体育世界》</td>
<td>周一至日21：30</td>
<td>9600</td>
<td>18000</td>
<td>32400</td>
</tr>
</tbody></table>
<p>1、《体坛快讯》、《体育新闻》、《体育世界》以上下半月为签约单位。其他栏目最小签约单位为四四；<br>2、栏目广告在各伴目中插播，栏目价格均为首播价格；<br>3、播出时间以当日中央电视台节目预告为准。</p>
<p><strong>栏目月套价格（4周28次，单位：元）</strong></p>
<table>
<thead>
<tr>
<th>5秒</th>
<th>15秒</th>
<th>30秒</th>
</tr>
</thead>
<tbody><tr>
<td>256000</td>
<td>480000</td>
<td>864000</td>
</tr>
</tbody></table>
<p>备注：栏目套组合一周晚间栏目，包括周一《天下足球》、周二《五环夜话》、周三直播赛事、周四《足球之夜》、周五《NBA》、周六、周日直播赛事，广告在以上栏目&#x2F;赛事中插播，每期1次，每周7次。</p>
<p><strong>2001年体育频道栏目套价格方案<br>组合周一到周日每天晚间栏目或赛事，包括：</strong></p>
<table>
<thead>
<tr>
<th>栏目</th>
<th>播出安排</th>
</tr>
</thead>
<tbody><tr>
<td>《天下足球》</td>
<td>周一20：00-21：30</td>
</tr>
<tr>
<td>《五环夜话》</td>
<td>周二20：30-21：30</td>
</tr>
<tr>
<td>周三直播赛事</td>
<td>周三约19：30</td>
</tr>
<tr>
<td>《足球之夜》</td>
<td>周四约20：00-21：30</td>
</tr>
<tr>
<td>《NBA》</td>
<td>周五19：30-21：30</td>
</tr>
<tr>
<td>周六直播赛事</td>
<td>周六约21：30</td>
</tr>
<tr>
<td>周日直播赛事</td>
<td>周日约21：30</td>
</tr>
</tbody></table>
<p>1、凡在本频道进行广告投放，一律执行先交费、后播出的原则；<br>2、法定节假日广告费加价20%，其中包括：农历大年三十、正月初一、初二、初三、四月三十日、五月一、二、三日，九月三十日、十月一、二、三日，十二月三十一日、一月一日（时段套不执行节假日加价）；<br>3、各时段广告指定正一和倒一加收2%，正二和倒二加收16%，正三和倒三加收12%，正四和倒四加收8%，正五和倒五加收5%，遇重大节目（赛事）或特殊宣传活动，广告价格及指定位置加价比例另行制定。<br>4、酒类广告价格在原价格基础上加收10%；<br>5、以集群形式播出的广告，30秒广告限产品6个，15秒广告限产品3个，广告价格在原价格基础上加收60%；<br>6、有关广告投放的其他规定，均参照中央电视台广告部2001年有关标准执行；<br>7、本价目表从2001年1月1日起执行，此前所印制的中央电视台体育频道价目表和说明停止使用。</p>
<p>中国国际电视总公司广告部<br>北京未来广告公司</p>
<p><strong>中央电视台电影频道</strong></p>
<p><a target="_blank" rel="noopener" href="http://www.cctv.com/profile/adver/adcctv6.html">http://www.cctv.com/profile/adver/adcctv6.html</a></p>
<p><strong>2001年1月1日起执行</strong>　　　　　　　　　　　　　　　　　　　　　单位:人民币元&#x2F;次</p>
<table>
<thead>
<tr>
<th></th>
<th><strong>5秒</strong></th>
<th><strong>10秒</strong></th>
<th><strong>15秒</strong></th>
<th><strong>20秒</strong></th>
<th><strong>25秒</strong></th>
<th><strong>30秒</strong></th>
</tr>
</thead>
<tbody><tr>
<td>A1 约18:20</td>
<td>3200</td>
<td>5800</td>
<td>8000</td>
<td>10800</td>
<td>13000</td>
<td>14400</td>
</tr>
<tr>
<td>A2 约18:50</td>
<td>3600</td>
<td>6600</td>
<td>9000</td>
<td>12400</td>
<td>14000</td>
<td>16200</td>
</tr>
<tr>
<td>A3 约19:40</td>
<td>7600</td>
<td>14000</td>
<td>19000</td>
<td>26200</td>
<td>31000</td>
<td>33000</td>
</tr>
<tr>
<td>A4 约20:30</td>
<td>9500</td>
<td>17500</td>
<td>23800</td>
<td>32800</td>
<td>37800</td>
<td>41000</td>
</tr>
<tr>
<td>B1 约21:40</td>
<td>9200</td>
<td>16800</td>
<td>23000</td>
<td>32000</td>
<td>36000</td>
<td>40000</td>
</tr>
<tr>
<td>B2 约22:30</td>
<td>6500</td>
<td>12000</td>
<td>16300</td>
<td>22600</td>
<td>26600</td>
<td>29000</td>
</tr>
<tr>
<td>C1 约23:30</td>
<td>3600</td>
<td>6600</td>
<td>9000</td>
<td>12400</td>
<td>14800</td>
<td>16200</td>
</tr>
<tr>
<td>C2约24：30</td>
<td>2400</td>
<td>4400</td>
<td>6000</td>
<td>8200</td>
<td>9600</td>
<td>10800</td>
</tr>
<tr>
<td>其他 约18:00前</td>
<td>2800</td>
<td>5200</td>
<td>7000</td>
<td>9200</td>
<td>11600</td>
<td>12600</td>
</tr>
<tr>
<td>其它 约24:30后</td>
<td>1300</td>
<td>2400</td>
<td>3200</td>
<td>4000</td>
<td>4600</td>
<td>5000</td>
</tr>
<tr>
<td>黄金套播 每日9次</td>
<td>24000</td>
<td>38400</td>
<td>48000</td>
<td>68000</td>
<td>80000</td>
<td>90000</td>
</tr>
<tr>
<td>晚间套播 每日7次</td>
<td>22000</td>
<td>35600</td>
<td>44000</td>
<td>58000</td>
<td>70000</td>
<td>80000</td>
</tr>
<tr>
<td>银屏导视 每日7-9次</td>
<td>19200</td>
<td>31000</td>
<td>38000</td>
<td>52000</td>
<td>62000</td>
<td>68000</td>
</tr>
<tr>
<td>综合套播 每日9次</td>
<td>16000</td>
<td>26000</td>
<td>32000</td>
<td>42000</td>
<td>50000</td>
<td>56000</td>
</tr>
</tbody></table>
<p><strong>注:45秒价格:15秒+30秒 60秒价格:30就+30秒 代理费:15%</strong></p>
<p><strong>国家广播电影电视总局电影卫星频道节目制作中心广告部</strong></p>
<blockquote>
<p><strong>说　　明</strong></p>
</blockquote>
<p>1、在电影频道播出的广告必须符合《中华人民共和国广告法》和国家有关部门规定。</p>
<p>2、在电影频道办理广告业务，一律执行先交费后播出的原则。</p>
<p>3、签定电影频道广告播出协议时，应具备下列相关的条件； （1）持有电影频道广告部核发的广告代理证和媒介员证。 （2）广告客户营业执照、商标注册证明、卫生许可证、生产许可证等其它有效证明。 （3）药品、医疗器械、特效化妆品、房地产、保健食品等应附送国家主管部门的准播批文。 （4）经电影频道广告部审查过的Bentacam广告带。 （5）交纳有效的银行转帐支票或汇票。 （6）广告公司与广告客户签定的合同。</p>
<p>4、广告按周为单元订购，如非连续性订购加价50%。</p>
<p>5、广告带应提前15天送达电影频道广告部。</p>
<p>6、在各段位广告中，指定播出位置第一条和倒数第一条每条加收20%，指定第二条和倒数第二条每条加收15%。</p>
<p>7、凡经电影频道广告部审定认可的组合广告、形象广告其价格在合理的幅度实施浮动。</p>
<p>8、电影频道的重大电影节目广告、贴片广告，其价格在合理的幅度实施浮动。</p>
<p>9、与我部签定广告播出协议后，若在播出前30日内要求停播退款50%，若在10日内要求停播不予退款。</p>
<p>10、若对播出的广告有疑义，应在播出后一周内提出，经电影频道广告部核实确认后进行调整。</p>
<p>11、本价格表从2001年1月1日起执行。</p>
<p><strong>中国中央电视台八套广告价格</strong></p>
<p><a target="_blank" rel="noopener" href="http://www.cctv.com/profile/adver/adcctv8.html">http://www.cctv.com/profile/adver/adcctv8.html</a></p>
<p><strong>2001年1月1日起执行</strong></p>
<table>
<thead>
<tr>
<th></th>
<th>广告位置</th>
<th>节目播出时间</th>
<th>价 格</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>5秒</td>
<td>15秒</td>
<td>30秒</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>电视剧 贴片广告</td>
<td>黄金强档贴片</td>
<td>首播周一至周五20:35,重播周二至周日10:10</td>
<td>15000</td>
<td>26000</td>
<td>48000</td>
</tr>
<tr>
<td>黄金强档集间</td>
<td>首播周一至周五21:15,重播周二至周日11:00</td>
<td>15000</td>
<td>26000</td>
<td>48000</td>
<td></td>
</tr>
<tr>
<td>海外剧场贴片</td>
<td>首播周一至周五22:45,重播周二至周六15:10</td>
<td>7000</td>
<td>12800</td>
<td>23000</td>
<td></td>
</tr>
<tr>
<td>百姓剧场贴片</td>
<td>首播每天12:40,重播次日8:30</td>
<td>4500</td>
<td>8000</td>
<td>15000</td>
<td></td>
</tr>
<tr>
<td>少儿剧苑贴片</td>
<td>每天18:05</td>
<td>4500</td>
<td>8000</td>
<td>15000</td>
<td></td>
</tr>
<tr>
<td>子夜剧贴片</td>
<td>周一至周三首播23:40,重播周二至周四13:15</td>
<td>3200</td>
<td>5800</td>
<td>10800</td>
<td></td>
</tr>
<tr>
<td>精品重播集间</td>
<td>周一至周日16:50</td>
<td>3200</td>
<td>5800</td>
<td>10800</td>
<td></td>
</tr>
<tr>
<td>栏目 广告</td>
<td>影视同期声</td>
<td>每天3次，首播周一至周六22:10,重播次日12:15、17:40</td>
<td>10000</td>
<td>18000</td>
<td>32800</td>
</tr>
<tr>
<td>走进电视</td>
<td>首播周日21:15,重播周一11:00、15:10,周日17:40</td>
<td>7000</td>
<td>12800</td>
<td>23000</td>
<td></td>
</tr>
<tr>
<td>世界影视博览</td>
<td>首播周日21:50,重播周一11:35,周六22:45,周日15:10</td>
<td>7000</td>
<td>12800</td>
<td>23000</td>
<td></td>
</tr>
<tr>
<td>世界名著名片欣赏</td>
<td>首播周日22:45,重播周一13:15,及CCTV-1周六23:30左右</td>
<td>6600</td>
<td>12800</td>
<td>22000</td>
<td></td>
</tr>
<tr>
<td>世界影视城</td>
<td>首播周六23:40,重播周日13:15</td>
<td>6000</td>
<td>11000</td>
<td>20000</td>
<td></td>
</tr>
<tr>
<td>原声影视</td>
<td>首播周五23:40,重播周六13:15</td>
<td>6000</td>
<td>11000</td>
<td>20000</td>
<td></td>
</tr>
<tr>
<td>国际影院</td>
<td>首播周四23:40,重播周五13:15</td>
<td>6000</td>
<td>11000</td>
<td>20000</td>
<td></td>
</tr>
<tr>
<td>栏目 周套</td>
<td>影视金曲套</td>
<td>每周21次:每日9:00、14:55、18:55、22:30左右</td>
<td>45000</td>
<td>80000</td>
<td>144000</td>
</tr>
<tr>
<td>动物世界、世界各地、 世界文化广场栏目套</td>
<td>每周14次，首播3次,周五、六、日19:05，重播11次</td>
<td>22000</td>
<td>40000</td>
<td>72000</td>
<td></td>
</tr>
</tbody></table>
<p>业务电话：010-68522561 68509311 68509502 68508209<br>　　　　　68509837 68515531 68507404 68507403<br>　　　　　68509310 68507424 68508421 68508721<br>咨询电话：010-68509505 68508467 68539648<br>广告审片：010-68509836<br>版本签定：010-68509873<br>汇款请汇：<br>单 位：中央电视台计财处五科<br>开 户 行：工商银行南礼士路分理处<br>帐 号：144820-44<br>地 址：中国北京海淀区复兴路11号<br>财务电话：010-68509506 68507405</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/02/06/25%E5%B9%B4%E5%89%8D%E4%B8%AD%E5%A4%AE%E7%94%B5%E8%A7%86%E5%8F%B0%E5%B9%BF%E5%91%8A%E6%8A%A5%E4%BB%B7/" data-id="cm6swutil000b8q74506b4i1g" data-title="25年前中央电视台广告报价" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-计算机领域的算法" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/02/06/%E8%AE%A1%E7%AE%97%E6%9C%BA%E9%A2%86%E5%9F%9F%E7%9A%84%E7%AE%97%E6%B3%95/" class="article-date">
  <time class="dt-published" datetime="2025-02-06T05:41:40.000Z" itemprop="datePublished">2025-02-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/02/06/%E8%AE%A1%E7%AE%97%E6%9C%BA%E9%A2%86%E5%9F%9F%E7%9A%84%E7%AE%97%E6%B3%95/">计算机领域的算法</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>计算机编程领域涉及大量算法，广泛应用于各个方向，如排序、搜索、图算法、动态规划、机器学习等。以下是较为全面的算法分类及其代表性算法：</p>
<hr>
<h3 id="1-排序算法（Sorting-Algorithms）"><a href="#1-排序算法（Sorting-Algorithms）" class="headerlink" title="1. 排序算法（Sorting Algorithms）"></a><strong>1. 排序算法（Sorting Algorithms）</strong></h3><pre><code>-	交换排序
-	冒泡排序（Bubble Sort）
-	快速排序（Quick Sort）
-	插入排序
-	直接插入排序（Insertion Sort）
-	希尔排序（Shell Sort）
-	选择排序
-	选择排序（Selection Sort）
-	堆排序（Heap Sort）
-	归并排序
-	归并排序（Merge Sort）
-	分布式排序
-	计数排序（Counting Sort）
-	基数排序（Radix Sort）
-	桶排序（Bucket Sort）
</code></pre>
<h3 id="2-搜索算法（Search-Algorithms）"><a href="#2-搜索算法（Search-Algorithms）" class="headerlink" title="2. 搜索算法（Search Algorithms）"></a><strong>2. 搜索算法（Search Algorithms）</strong></h3><pre><code>-	线性搜索
-	顺序查找（Linear Search）
-	二分查找
-	二分搜索（Binary Search）
-	插值查找（Interpolation Search）
-	哈希查找
-	哈希查找（Hashing Search）
-	树搜索
-	深度优先搜索（Depth-First Search, DFS）
-	广度优先搜索（Breadth-First Search, BFS）
-	A搜索（A Search）
-	图搜索
-	Dijkstra 算法（Dijkstra’s Algorithm）
-	Bellman-Ford 算法（Bellman-Ford Algorithm）
-	Floyd-Warshall 算法（Floyd-Warshall Algorithm）
-	A* 算法（A* Algorithm）
</code></pre>
<h3 id="3-图算法（Graph-Algorithms）"><a href="#3-图算法（Graph-Algorithms）" class="headerlink" title="3. 图算法（Graph Algorithms）"></a><strong>3. 图算法（Graph Algorithms）</strong></h3><pre><code>-	最短路径算法
-	Dijkstra 算法
-	Bellman-Ford 算法
-	Floyd-Warshall 算法
-	Johnson 算法（Johnson’s Algorithm）
-	最小生成树（MST）
-	Prim 算法（Prim’s Algorithm）
-	Kruskal 算法（Kruskal’s Algorithm）
-	拓扑排序
-	Kahn 算法（Kahn’s Algorithm）
-	DFS 逆后序排序
-	网络流算法
-	Ford-Fulkerson 算法（Ford-Fulkerson Algorithm）
-	Edmonds-Karp 算法（Edmonds-Karp Algorithm）
-	图的连通性
-	Tarjan 强连通分量算法（Tarjan’s Algorithm）
-	Kosaraju 算法（Kosaraju’s Algorithm）
-	二分图匹配
-	匈牙利算法（Hungarian Algorithm）
-	欧拉路径与哈密顿路径
-	Fleury 算法（Fleury’s Algorithm）
-	Hierholzer 算法（Hierholzer’s Algorithm）
</code></pre>
<h3 id="4-动态规划（Dynamic-Programming-DP）"><a href="#4-动态规划（Dynamic-Programming-DP）" class="headerlink" title="4. 动态规划（Dynamic Programming, DP）"></a><strong>4. 动态规划（Dynamic Programming, DP）</strong></h3><pre><code>-	基本问题
-	斐波那契数列（Fibonacci Sequence）
-	矩阵连乘（Matrix Chain Multiplication）
-	最长公共子序列（LCS, Longest Common Subsequence）
-	最长递增子序列（LIS, Longest Increasing Subsequence）
-	背包问题（Knapsack Problem）
-	最优二分检索树（Optimal Binary Search Tree）
-	0/1 背包问题（0/1 Knapsack Problem）
-	完全背包问题（Unbounded Knapsack Problem）
-	编辑距离（Edit Distance）
-	最短路径（Floyd-Warshall 算法）
</code></pre>
<h3 id="5-贪心算法（Greedy-Algorithms）"><a href="#5-贪心算法（Greedy-Algorithms）" class="headerlink" title="5. 贪心算法（Greedy Algorithms）"></a><strong>5. 贪心算法（Greedy Algorithms）</strong></h3><pre><code>-	活动选择问题（Activity Selection Problem）
-	哈夫曼编码（Huffman Coding）
-	Kruskal 最小生成树（Kruskal’s MST Algorithm）
-	Prim 最小生成树（Prim’s MST Algorithm）
-	Dijkstra 最短路径（Dijkstra’s Algorithm）
-	区间覆盖问题（Interval Scheduling）
</code></pre>
<h3 id="6-计算几何算法（Computational-Geometry-Algorithms）"><a href="#6-计算几何算法（Computational-Geometry-Algorithms）" class="headerlink" title="6. 计算几何算法（Computational Geometry Algorithms）"></a><strong>6. 计算几何算法（Computational Geometry Algorithms）</strong></h3><pre><code>-	凸包问题
-	Graham 扫描法（Graham’s Scan）
-	Jarvis’s March（Gift Wrapping）
-	最近点对问题
-	最近点对分治算法（Closest Pair of Points）
-	多边形算法
-	判断点是否在多边形内部（Point in Polygon）
-	多边形相交测试（Polygon Intersection）
-	旋转卡壳算法（Rotating Calipers）
</code></pre>
<h3 id="7-字符串算法（String-Algorithms）"><a href="#7-字符串算法（String-Algorithms）" class="headerlink" title="7. 字符串算法（String Algorithms）"></a><strong>7. 字符串算法（String Algorithms）</strong></h3><pre><code>-	模式匹配
-	KMP 算法（Knuth-Morris-Pratt）
-	Boyer-Moore 算法
-	Rabin-Karp 算法
-	最长公共子串
-	动态规划法
-	后缀数组法
-	Trie 树
-	基于 Trie 的搜索（Trie-based Search）
-	Aho-Corasick 多模式匹配算法
-	后缀数组
-	SA-IS 算法
-	DC3 算法
-	Kasai’s LCP 算法
</code></pre>
<h3 id="8-数论与数学算法（Number-Theory-Mathematical-Algorithms）"><a href="#8-数论与数学算法（Number-Theory-Mathematical-Algorithms）" class="headerlink" title="8. 数论与数学算法（Number Theory &amp; Mathematical Algorithms）"></a><strong>8. 数论与数学算法（Number Theory &amp; Mathematical Algorithms）</strong></h3><pre><code>-	质数相关
-	埃拉托色尼筛法（Sieve of Eratosthenes）
-	线性筛法
-	最大公约数与最小公倍数
-	欧几里得算法（Euclidean Algorithm）
-	扩展欧几里得算法（Extended Euclidean Algorithm）
-	模运算
-	快速幂（Modular Exponentiation）
-	逆元求解
-	中国剩余定理（CRT, Chinese Remainder Theorem）
-	费马小定理（Fermat’s Little Theorem）
-	米勒-拉宾素数测试（Miller-Rabin Primality Test）
</code></pre>
<h3 id="9-机器学习与人工智能相关算法"><a href="#9-机器学习与人工智能相关算法" class="headerlink" title="9. 机器学习与人工智能相关算法"></a><strong>9. 机器学习与人工智能相关算法</strong></h3><pre><code>-	监督学习
-	线性回归（Linear Regression）
-	逻辑回归（Logistic Regression）
-	决策树（Decision Tree）
-	支持向量机（SVM, Support Vector Machine）
-	无监督学习
-	K 均值聚类（K-Means Clustering）
-	DBSCAN（Density-Based Spatial Clustering）
-	主成分分析（PCA, Principal Component Analysis）
-	深度学习
-	反向传播（Backpropagation）
-	卷积神经网络（CNN, Convolutional Neural Network）
-	循环神经网络（RNN, Recurrent Neural Network）
-	Transformer 模型
-	强化学习
-	Q-learning
-	蒙特卡洛方法（Monte Carlo Methods）
</code></pre>
<h3 id="10-近似算法与启发式算法"><a href="#10-近似算法与启发式算法" class="headerlink" title="10. 近似算法与启发式算法"></a><strong>10. 近似算法与启发式算法</strong></h3><pre><code>-	模拟退火（Simulated Annealing）
-	遗传算法（Genetic Algorithm, GA）
-	粒子群优化（Particle Swarm Optimization, PSO）
-	蚁群算法（Ant Colony Optimization, ACO）
-	禁忌搜索（Tabu Search）
-	贝叶斯优化（Bayesian Optimization）
</code></pre>
<p>以上是计算机编程领域的主要算法分类和代表算法，不同领域还有专门优化的算法。你是否有特定的算法方向想深入了解？ 😊</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/02/06/%E8%AE%A1%E7%AE%97%E6%9C%BA%E9%A2%86%E5%9F%9F%E7%9A%84%E7%AE%97%E6%B3%95/" data-id="cm6swutix00388q74408s2y4g" data-title="计算机领域的算法" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-在 SwiftUI 中构建照片库应用程序" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/10/28/%E5%9C%A8%20SwiftUI%20%E4%B8%AD%E6%9E%84%E5%BB%BA%E7%85%A7%E7%89%87%E5%BA%93%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/" class="article-date">
  <time class="dt-published" datetime="2024-10-28T01:35:31.592Z" itemprop="datePublished">2024-10-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="在-SwiftUI-中构建照片库应用程序"><a href="#在-SwiftUI-中构建照片库应用程序" class="headerlink" title="在 SwiftUI 中构建照片库应用程序"></a>在 SwiftUI 中构建照片库应用程序</h1><p>你好！欢迎来到 CodeWithChris 的新文章系列！在本系列中，我将分享我在 SwiftUI 中构建简单的照片库应用程序的个人经验。</p>
<p>– 伊纳基·纳西索 (Iñaki Narciso) 撰写，2022 年 9 月 20 日</p>
<p> <strong>目录</strong></p>
<ol>
<li><strong>介绍</strong></li>
<li><a target="_blank" rel="noopener" href="https://codewithchris.com/photo-gallery-app-swiftui-part-1">第 1 部分：使用 PhotoKit 进行内存管理</a></li>
<li><a target="_blank" rel="noopener" href="https://codewithchris.com/photo-gallery-app-swiftui-part-2">第 2 部分：照片网格 UI 的内存管理实践</a></li>
<li><a target="_blank" rel="noopener" href="https://codewithchris.wpengine.com/photo-gallery-app-swiftui-part-3/">第 3 部分：创建照片库应用程序</a></li>
<li><a target="_blank" rel="noopener" href="https://codewithchris.wpengine.com/photo-gallery-app-swiftui-part-4/">第 4 部分：添加多个手势</a></li>
</ol>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>你好！欢迎来到 CodeWithChris 的新文章系列！在本系列中，我将分享我在 SwiftUI 中构建简单的照片库应用程序的个人经验。</p>
<p>在我们继续之前，我想让您知道我无论如何都不是 SwiftUI 专家。几个月前我开始了我的 SwiftUI 学习之旅，但我在 UIKit 方面有很好的经验。您可以看到我到处添加一些 UIKit 参考资料，但照片库应用程序的所有代码以及本系列的内容都是 100% SwiftUI 编写的。</p>
<p>本系列分为多篇文章，我们将涵盖构建照片库应用程序的不同主题和技术。我建议您按顺序阅读本系列，以便您在阅读本系列时可以更清楚地掌握进展情况。</p>
<p>在本系列中，我们将使用<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/photokit">PhotoKit</a>来访问用户的照片库并获取将在应用程序中显示的照片。 PhotoKit 是 Apple 的框架，允许开发人员使用照片应用程序管理的图像和视频资源，包括来自 iCloud 照片和实时照片的图像和视频资源。</p>
<p>我们还将讨论<strong>内存管理</strong>等重要主题。照片往往会快速消耗内存，尤其是在具有大型用户库的网格 UI 中显示时。我们将讨论照片如何消耗内存、内存管理不佳的问题以及如何使用 PhotoKit 为我们处理这些内存管理问题。</p>
<p>我们将使用一个特定的 SwiftUI 视图在网格界面中显示用户的照片库 - <strong>LazyVGrid</strong> 。它有一个内置的内存管理机制，仅在必要时才加载其子视图，因此加载大型库不会导致大量的内存使用。然而，单独使用这种内存管理机制不足以支持照片库应用程序的内存需求。我们将在本系列文章中介绍其中的原因。</p>
<p>照片库应用程序将采用 100% SwiftUI 构建。当我们开发这个应用程序时，不会包含任何 UIKit 视图。然而，我们将讨论<strong>UICollectionViewController</strong>和<strong>UICollectionViewCells</strong>的一些重要的内存管理机制，它们是 UIKit 中相当于<strong>LazyVGrid</strong>的机制。</p>
<p>我们将发现两者之间的关键区别，并利用这种学习来改进我们的<strong>LazyVGrid</strong>视图，以提高内存性能。这听起来可能相当复杂，但解决方案却出奇的简单。</p>
<p>在构建内存性能照片网格 UI 后，我们将详细介绍如何构建照片详细视图。详细视图将显示以黑色背景视图为中心的照片。我们还将添加对<strong>DragGesture</strong> 、 <strong>MagnificationGesture</strong>和<strong>TapGesture</strong>等手势的支持，以添加更精细的控件，使用户能够更详细地检查照片。我们还将讨论添加手势的挑战，例如在视图范围内平移缩放照片。</p>
<p>我很高兴向您展示我在构建此应用程序时学到的所有知识，并且希望您也能喜欢学习它！</p>
<h3 id="先决条件"><a href="#先决条件" class="headerlink" title="先决条件"></a>先决条件</h3><p>您无需成为 SwiftUI 大师即可阅读本系列，但需要具备 SwiftUI 的基础知识。</p>
<p>您也不需要有任何 UIKit 经验。我们不会在代码中使用任何 UIKit，但本系列后面会有一个关于 UIKit 视图的内存管理机制的主题。这些只是为了解释我们开发应用程序时至关重要的概念。我将尽力尽可能简单地解释 UIKit 概念。</p>
<p>如果您在学习本系列文章时遇到困难，我建议您首先完成我们的<a target="_blank" rel="noopener" href="https://learn.codewithchris.com/courses/start">14 天初学者挑战，</a>以帮助您开始使用 SwiftUI。</p>
<h3 id="接下来"><a href="#接下来" class="headerlink" title="接下来"></a>接下来</h3><p>本系列的第 1 部分将向您展示如何为 PhotoKit 创建一个服务层，这将为我们做两件事。第一个是询问用户访问照片库的权限，第二个是从库中获取并缓存照片。我们还将探讨如果没有适当的内存管理，可能会出现什么问题。希望这也能让您兴奋地学习。我们下一场见！</p>
<h1 id="第-1-部分：使用-PhotoKit-进行内存管理"><a href="#第-1-部分：使用-PhotoKit-进行内存管理" class="headerlink" title="第 1 部分：使用 PhotoKit 进行内存管理"></a>第 1 部分：使用 PhotoKit 进行内存管理</h1><p>您好，欢迎回来！这是“在 SwiftUI 中构建照片库应用程序”系列的 4 部分中的第 1 部分。在这篇文章中，我们将讨论内存管理。内存是一种非常重要的资源，因为它被许多应用程序（包括系统本身）共享。</p>
<p>您好，欢迎回来！这是<strong>在 SwiftUI 中构建照片库应用程序</strong>系列的 4 部分中的第 1 部分。</p>
<p>在这篇文章中，我们将讨论内存管理。内存是一种非常重要的资源，因为它被许多应用程序（包括系统本身）共享。如果您不小心，照片会很快消耗内存，并且一次加载整个库将导致内存的过度使用。应用程序崩溃和性能低下是内存管理不良最常见的影响。</p>
<h3 id="数码照片的剖析"><a href="#数码照片的剖析" class="headerlink" title="数码照片的剖析"></a>数码照片的剖析</h3><p>单张照片的内存消耗取决于以下因素：</p>
<ol>
<li><strong>分辨率</strong>——显示照片所需的像素总数</li>
<li><strong>压缩</strong>– 通常由文件类型决定，图像的压缩将根据其颜色空间和不透明度及其节省内存的策略来确定渲染图像需要多少字节。最常见的压缩类型是 JPEG（有损压缩）和 PNG（无损压缩）。我不会更详细地讨论两者之间的差异，但图像压缩是决定内存中图像总大小的因素之一。</li>
</ol>
<p>假设我们从现代 12MP 相机（例如 iPhone 13 相机）拍摄一张照片。生成的照片的分辨率为<strong>4290 x 2800</strong> 。仅分辨率就需要总共 1200 万像素才能完全渲染照片。假设我们不使用压缩算法来减小大小，但支持 alpha 透明度信息 (ARGB) – 这意味着我们需要 8 位来表示 alpha 透明度，8 位来表示红色信息，8 位来表示蓝色信息颜色信息，8位表示绿色信息。每个像素的颜色空间和透明度信息总共需要 32 位（ARGB 各 8 位）才能完全渲染其颜色。</p>
<p>因此，要渲染全彩色照片，我们需要 1200 万像素乘以每个像素的 32 位颜色 &#x3D; 384Mbits（兆位），大约为 48MB（兆字节：8 位 &#x3D; 1 字节）。理论上，一张没有压缩格式的现代照片每张将花费 48Mb。其中 10 张照片将花费 480Mb。一百个将花费 4.8Gb。你明白了。</p>
<p>假设普通 iPhone 用户的照片库中总共可以有 25,000 张照片，以与上例相同的分辨率加载所有不带压缩格式的照片理论上需要 1.2Tb 内存。如果我们选择一次性加载所有内容，现代 iPhone 都无法处理。</p>
<p>实际上，采用 JPEG 或 PNG 等现代压缩格式的照片成本要低得多，但即使照片因压缩而尺寸较小，加载整个库在内存中仍然非常昂贵。</p>
<h3 id="在照片库应用程序中管理内存"><a href="#在照片库应用程序中管理内存" class="headerlink" title="在照片库应用程序中管理内存"></a>在照片库应用程序中管理内存</h3><ol>
<li><strong>按需加载照片</strong>– 仅在必要时将照片存储在内存中。在照片库应用中，即使用户的照片库很大，一次也只能显示少量照片。当用户滚动浏览图库时，应该从内存中释放经过滚动区域的照片，并且仅加载要显示的新照片。</li>
<li><strong>避免直接引用照片</strong>- 由于照片消耗内存的速度非常快，因此我们需要避免在代码中直接引用它们，而仅通过 ID 或 URL 引用它们。直接引用照片可能会导致内存重复，我们不希望单张照片在我们的内存中多次存在。由于我们想要使用 PhotoKit 从用户的库中获取照片，因此我们可以使用资产 ID 间接引用照片。如果我们需要在屏幕上加载照片，我们可以告诉 PhotoKit 获取并缓存照片，并让该套件为我们处理所有内存管理。</li>
<li><strong>避免内存中的照片重复</strong>- 将照片从一个屏幕传递到另一个屏幕时，我们不应该传递照片本身的副本。我们可以将照片的引用作为 ID（如果使用 PhotoKit）或 URL（如果从缓存或网络获取）发送。</li>
<li><strong>有效利用磁盘缓存</strong>- 从库或网络获取照片需要时间。为了加快下次需要显示照片时的加载速度，您应该将其缓存到磁盘。在 PhotoKit 中，这是由照片缓存管理器处理的。当您第一次告诉 PhotoKit 获取照片时，缓存管理器会自动将照片缓存在磁盘上，这样下次需要时加载照片的时间就会更短。但要小心！缓存是易失性的 - 这意味着它只会在应用程序处于活动状态时将照片保留在缓存中。如果应用程序关闭或终止，缓存中的照片将会丢失。缓存从网络获取的照片是另一回事，因为您可以灵活地调整自己的缓存策略。</li>
</ol>
<h3 id="使用照片套件"><a href="#使用照片套件" class="headerlink" title="使用照片套件"></a>使用照片套件</h3><p>PhotoKit 是一个 Apple 框架，允许我们的应用程序处理由“照片”应用程序管理的照片和视频资源。这还包括由 iCloud Photos 和 Live Photos 管理的照片和视频，但我们的照片库应用程序中不需要这些。</p>
<p>为了抽象所有 PhotoKit 代码，我创建了一个服务，它将为我们执行以下操作：</p>
<ol>
<li><strong>请求访问照片库</strong>- 为了从照片库中获取照片，用户需要向应用程序授予此访问权限。</li>
<li><strong>从图库中获取照片</strong>- 一旦获得访问权限，我们就可以获取可以在应用程序中显示的照片。获取将包括设置限制（例如出于隐私原因排除隐藏的照片）和设置排序顺序（例如首先显示最新的照片）。</li>
<li><strong>缓存获取的照片</strong>– 应缓存所有获取的照片，以便下次我们需要向用户显示它时加载时间会更少。</li>
</ol>
<h4 id="请求访问用户的照片库"><a href="#请求访问用户的照片库" class="headerlink" title="请求访问用户的照片库"></a>请求访问用户的照片库</h4><p>为了请求访问，我们首先需要存储用户授予的当前权限。我们可以稍后向 PhotoKit 询问确切的权限，但现在，让我们从<code>.notDetermined</code>开始。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> Photos</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PhotoLibraryService</span>: <span class="title class_">ObservableObject</span> &#123;</span><br><span class="line">	<span class="operator">...</span></span><br><span class="line">	<span class="comment">/// The permission status granted by the user</span></span><br><span class="line">	<span class="comment">/// This property will determine if we need to request</span></span><br><span class="line">	<span class="comment">/// for library access or not</span></span><br><span class="line">    <span class="keyword">var</span> authorizationStatus: <span class="type">PHAuthorizationStatus</span> <span class="operator">=</span> .notDetermined</span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来是添加显示访问用户照片库的请求的功能。该函数将采用一个可选的错误关闭参数，以便我们可以允许 UI 在用户决定不授予照片库访问权限时显示错误。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PhotoLibraryService</span>: <span class="title class_">ObservableObject</span> &#123;</span><br><span class="line">	<span class="operator">...</span></span><br><span class="line">	<span class="keyword">func</span> <span class="title function_">requestAuthorization</span>(</span><br><span class="line">        <span class="params">handleError</span>: ((<span class="type">AuthorizationError</span>?) -&gt; <span class="type">Void</span>)<span class="operator">?</span> <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line">    ) &#123;</span><br><span class="line">	    <span class="comment">/// This is the code that does the permission requests</span></span><br><span class="line">        <span class="type">PHPhotoLibrary</span>.requestAuthorization &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] status <span class="keyword">in</span></span><br><span class="line">	        <span class="keyword">self</span><span class="operator">?</span>.authorizationStatus <span class="operator">=</span> status</span><br><span class="line">	        <span class="comment">/// We can determine permission granted by the status</span></span><br><span class="line">            <span class="keyword">switch</span> status &#123;</span><br><span class="line">            <span class="comment">/// Fetch all photos if the user granted us access</span></span><br><span class="line">            <span class="comment">/// This won&#x27;t be the photos themselves but the</span></span><br><span class="line">            <span class="comment">/// references only.</span></span><br><span class="line">            <span class="keyword">case</span> .authorized, .limited:</span><br><span class="line">                <span class="keyword">self</span><span class="operator">?</span>.fetchAllPhotos()</span><br><span class="line">            </span><br><span class="line">            <span class="comment">/// For denied response, we should show an error</span></span><br><span class="line">            <span class="keyword">case</span> .denied, .notDetermined, .restricted:</span><br><span class="line">                handleError<span class="operator">?</span>(.restrictedAccess)</span><br><span class="line">                </span><br><span class="line">            <span class="keyword">@unknown</span> <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用<code>authorizationStatus</code>属性，我们可以确定应用程序是否需要请求访问照片库，并使用<code>requestAuthorization()</code>函数本身执行实际的权限请求。</p>
<h4 id="从图库中获取照片"><a href="#从图库中获取照片" class="headerlink" title="从图库中获取照片"></a>从图库中获取照片</h4><p>现在我们已经有了一种方法来请求用户访问照片库的权限，接下来我们需要做的就是找到一种从照片库中获取照片参考的方法。</p>
<p>让我们首先添加一个变量来存储我们的获取结果。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PhotoLibraryService</span>: <span class="title class_">ObservableObject</span> &#123;</span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">	<span class="comment">/// https://stackoverflow.com/a/69755543</span></span><br><span class="line">	<span class="comment">/// A collection that allows subscript support to</span></span><br><span class="line">	<span class="comment">/// PHFetchResult&lt;PHAsset&gt;</span></span><br><span class="line">	<span class="comment">///</span></span><br><span class="line">	<span class="comment">/// The results property will store all of the photo asset ids </span></span><br><span class="line">	<span class="comment">/// that we requested, and will be used by our views to request </span></span><br><span class="line">	<span class="comment">/// for a copy of the photo itself.</span></span><br><span class="line">	<span class="comment">///</span></span><br><span class="line">    <span class="comment">/// We don&#x27;t want to store a copy of the actual photo as it would </span></span><br><span class="line">    <span class="comment">/// cost too much memory, especially if we show the photos in a</span></span><br><span class="line">    <span class="comment">/// grid.</span></span><br><span class="line">	<span class="meta">@Published</span> <span class="keyword">var</span> results <span class="operator">=</span> <span class="type">PHFetchResultCollection</span>(</span><br><span class="line">		fetchResult: .<span class="keyword">init</span>()</span><br><span class="line">	)</span><br><span class="line">	<span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>PHFetchResultCollection</code>是<code>PHFetchResult&lt;PHAsset&gt;</code>的集合包装器，但支持下标访问。稍后当我们需要创建网格 UI 时，我们将使用下标访问。</p>
<p>我们还需要一个<code>PHCachingImageManager</code>来为我们执行实际的照片获取和缓存。让我们将其添加到属性声明列表旁边：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PhotoLibraryService</span>: <span class="title class_">ObservableObject</span> &#123;</span><br><span class="line">	<span class="operator">...</span></span><br><span class="line">	<span class="comment">/// The manager that will fetch and cache photos for us</span></span><br><span class="line">    <span class="keyword">var</span> imageCachingManager <span class="operator">=</span> <span class="type">PHCachingImageManager</span>()</span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们现在有一个属性来存储我们的获取结果和一个管理器来为我们获取和缓存照片。让我们继续编写函数，告诉管理器从库中获取所有照片引用，并将它们存储在我们的 results 属性中。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PhotoLibraryService</span>: <span class="title class_">ObservableObject</span> &#123;</span><br><span class="line">	<span class="operator">...</span></span><br><span class="line">    <span class="comment">/// Function that will tell the image caching manager to fetch </span></span><br><span class="line">    <span class="comment">/// all photos from the user&#x27;s photo library. We don&#x27;t want to </span></span><br><span class="line">    <span class="comment">/// include hidden assets for obvious privacy reasons.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// We also need to sort the photos being fetched by the most </span></span><br><span class="line">    <span class="comment">/// recent first, mimicking the behaviour of the Recents album </span></span><br><span class="line">    <span class="comment">/// from the Photos app.</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">fetchAllPhotos</span>() &#123;</span><br><span class="line">        imageCachingManager.allowsCachingHighQualityImages <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">        <span class="keyword">let</span> fetchOptions <span class="operator">=</span> <span class="type">PHFetchOptions</span>()</span><br><span class="line">        fetchOptions.includeHiddenAssets <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">        fetchOptions.sortDescriptors <span class="operator">=</span> [</span><br><span class="line">            <span class="type">NSSortDescriptor</span>(key: <span class="string">&quot;creationDate&quot;</span>, ascending: <span class="literal">false</span>)</span><br><span class="line">        ]</span><br><span class="line">        <span class="type">DispatchQueue</span>.main.async &#123;</span><br><span class="line">            <span class="keyword">self</span>.results.fetchResult <span class="operator">=</span> <span class="type">PHAsset</span>.fetchAssets(with: .image, options: fetchOptions)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的函数仅获取照片参考，而不是实际照片本身。这是 PhotoKit 的内存管理机制之一，因为它仅在请求时才加载照片的图像。要使用图像资源 ID 实际加载图像，我们需要编写另一个接受图像资源 ID 并返回图像类型的函数。由于照片库应用程序将使用 100% SwiftUI 编写，因此我们将使用 SwiftUI <code>Image</code>在 UI 中渲染照片，而且 PhotoKit 返回<code>UIImage</code>实例是一件好事，因为 SwiftUI <code>Image</code>支持它。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> Photos</span><br><span class="line"><span class="keyword">import</span> UIKit <span class="comment">// Don&#x27;t forget to add this</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PhotoLibraryService</span>: <span class="title class_">ObservableObject</span> &#123;</span><br><span class="line">    <span class="comment">/// Requests an image copy given a photo asset id.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// The image caching manager performs the fetching, and will </span></span><br><span class="line">    <span class="comment">/// cache the photo fetched for later use. Please know that the </span></span><br><span class="line">    <span class="comment">/// cache is temporary – all photos cached will be lost when the</span></span><br><span class="line">    <span class="comment">/// app is terminated.</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">fetchImage</span>(</span><br><span class="line">        <span class="params">byLocalIdentifier</span> <span class="params">localId</span>: <span class="type">PHAssetLocalIdentifier</span>,</span><br><span class="line">        <span class="params">targetSize</span>: <span class="type">CGSize</span> <span class="operator">=</span> <span class="type">PHImageManagerMaximumSize</span>,</span><br><span class="line">        <span class="params">contentMode</span>: <span class="type">PHImageContentMode</span> <span class="operator">=</span> .default</span><br><span class="line">    ) <span class="keyword">async</span> <span class="keyword">throws</span> -&gt; <span class="type">UIImage</span>? &#123;</span><br><span class="line">        <span class="keyword">let</span> results <span class="operator">=</span> <span class="type">PHAsset</span>.fetchAssets(</span><br><span class="line">            withLocalIdentifiers: [localId],</span><br><span class="line">            options: <span class="literal">nil</span></span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> asset <span class="operator">=</span> results.firstObject <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">QueryError</span>.phAssetNotFound</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> options <span class="operator">=</span> <span class="type">PHImageRequestOptions</span>()</span><br><span class="line">        options.deliveryMode <span class="operator">=</span> .opportunistic</span><br><span class="line">        options.resizeMode <span class="operator">=</span> .fast</span><br><span class="line">        options.isNetworkAccessAllowed <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">        options.isSynchronous <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">try</span> <span class="keyword">await</span> withCheckedThrowingContinuation &#123; [<span class="keyword">weak</span> <span class="keyword">self</span>] continuation <span class="keyword">in</span></span><br><span class="line">	        <span class="comment">/// Use the imageCachingManager to fetch the image</span></span><br><span class="line">            <span class="keyword">self</span><span class="operator">?</span>.imageCachingManager.requestImage(</span><br><span class="line">                for: asset,</span><br><span class="line">                targetSize: targetSize,</span><br><span class="line">                contentMode: contentMode,</span><br><span class="line">                options: options,</span><br><span class="line">                resultHandler: &#123; image, info <span class="keyword">in</span></span><br><span class="line">	                <span class="comment">/// image is of type UIImage</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">let</span> error <span class="operator">=</span> info<span class="operator">?</span>[<span class="type">PHImageErrorKey</span>] <span class="keyword">as?</span> <span class="type">Error</span> &#123;</span><br><span class="line">                        continuation.resume(throwing: error)</span><br><span class="line">                        <span class="keyword">return</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    continuation.resume(returning: image)</span><br><span class="line">                &#125;</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用<code>PHCachingImageManager</code>实例的好处是，当它第一次获取照片时，它也会缓存照片。因此，当我们需要在其他时间获取照片时，加载速度会快得多！我们也不需要担心缓存策略和缓存的内存管理，因为 PhotoKit 已经为我们处理了这一切！</p>
<p>现在我们有了一个可以轻松使用的<code>PhotoLibraryService</code>类，让我们将它作为<code>environmentObject</code>依赖项添加到我们的 App 文件中，这样我们就可以轻松地从我们的视图中访问它。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">@main</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PhotoGalleryApp</span>: <span class="title class_">App</span> &#123;</span><br><span class="line">	<span class="keyword">let</span> photoLibraryService <span class="operator">=</span> <span class="type">PhotoLibraryService</span>()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">Scene</span> &#123;</span><br><span class="line">		<span class="type">WindowGroup</span> &#123;</span><br><span class="line">			<span class="type">PhotoLibraryView</span>() <span class="comment">// This is what we&#x27;ll do next</span></span><br><span class="line">				.environmentObject(photoLibraryService)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这篇文章中，您了解了照片库应用程序内存管理的基本要求，以及如何使用 PhotoKit 为我们进行获取、缓存和内存管理工作。</p>
<p>在下一篇文章中，我们将继续从用户界面的角度讨论内存管理，并且我们还将开始构建照片网格的 UI。现在就这些了。我们下一场见！</p>
<h1 id="第-2-部分：照片网格-UI-的内存管理实践"><a href="#第-2-部分：照片网格-UI-的内存管理实践" class="headerlink" title="第 2 部分：照片网格 UI 的内存管理实践"></a>第 2 部分：照片网格 UI 的内存管理实践</h1><p>在这篇文章中，我们将从用户界面的角度继续讨论内存管理。 UI 将在网格中显示照片，因此应用内存管理实践非常重要，这样当我们滚动照片时应用程序的内存消耗就不会增加。</p>
<p>您好，欢迎回来！这是<strong>在 SwiftUI 中构建照片库应用程序</strong>系列的 4 部分中的第 2 部分。</p>
<p>在本系列的第 1 部分中，我们讨论了照片库应用程序内存管理的基本要求。我们还讨论了如何使用 PhotoKit 为我们完成所有内存管理繁重工作。管理内存非常重要，特别是因为我们将在照片库应用程序中显示大量照片。我们不希望应用程序因内存管理不善而崩溃或执行缓慢。</p>
<p>在这篇文章中，我们将从用户界面的角度继续讨论内存管理。 UI 将在网格中显示照片，因此应用内存管理实践非常重要，这样当我们滚动照片时应用程序的内存消耗就不会增加。</p>
<h3 id="用户界面"><a href="#用户界面" class="headerlink" title="用户界面"></a>用户界面</h3><img src="https://user-images.githubusercontent.com/106976715/187477387-701f70b9-adc7-416f-b8e1-3d0c4ac8c860.png" width="360">

<p>我们要创建的用户界面类似于上面的屏幕截图 - 来自用户照片库的照片网格。对于纵向的 iPhone，网格将有 3 列行。每张照片都将被中心裁剪并包含在方形<code>Image</code> SwiftUI 视图中。我们将使用包裹在<code>ScrollView</code>中的<code>LazyVGrid</code> ，这样我们就可以在更多图像加载到网格中时滚动。</p>
<h3 id="惰性网格"><a href="#惰性网格" class="headerlink" title="惰性网格"></a>惰性网格</h3><p><code>LazyVGrid</code> SwiftUI 视图有一个内置的内存管理机制，仅在需要时加载其元素（因此，有“lazy”关键字）。这种行为对于照片库应用程序来说是理想的选择，因为用户可以拥有一个相当大的照片库。 <code>LazyVGrid</code>将仅加载需要在屏幕上显示的照片，因此照片仅按需添加到内存中。然而，延迟加载的内存管理机制是不够的，因为加载到内存中但滚动经过视图区域的照片将保留在内存中。</p>
<p>随着时间的推移，随着新照片加载到内存中并在滚动区域中查看，内存消耗会不断累积，直到系统内存耗尽，从而导致应用程序运行缓慢，或更严重的是崩溃。</p>
<p>管理照片网格 UI 内存消耗的理想机制是：</p>
<ol>
<li>在需要显示照片时加载照片，最好从缓存中加载。</li>
<li>释放超出滚动区域的照片。</li>
</ol>
<p><code>LazyVGrid</code>涵盖了机制#1，但缺少机制#2。为了避免用户滚动时内存随着时间的推移而积累，我们必须添加 UIKit 视图熟悉的新内存管理机制，例如单元格重用机制。</p>
<h3 id="UICollectionView-Cell-复用机制"><a href="#UICollectionView-Cell-复用机制" class="headerlink" title="UICollectionView Cell 复用机制"></a>UICollectionView Cell 复用机制</h3><p>在 UIKit 中，与<code>LazyVGrid</code> SwiftUI 视图最接近的等效项是使用以下任一视图的<code>UICollectionView</code> <code>UICollectionViewFlowLayout (iOS 12 below)</code> 或一个 <code>UICollectionViewCompositionalLayout (iOS 13 and later)</code> 。</p>
<img src="https://docs-assets.developer.apple.com/published/a84db79dea/50390428-f9f2-4cbc-bd99-1cacca4f0617.png" width= "650" >

<p>单元重用的想法是一次加载多个在网格上可见的单元，并在单元隐藏在视图之外时立即从内存中释放这些单元。当用户继续滚动到网格或列表中时，从内存中释放的单元格稍后将被重新使用以显示其他项目。</p>
<p>细胞重用的想法非常简单。如果屏幕上可以同时显示 20 个项目，则即使您有 100 万个项目要在屏幕上显示，一次也只会加载 20 个单元格。当任何单元格经过滚动区域时，它们应该从内存中释放，因为它们不再显示在屏幕上。释放的单元格将被另一个项目重复使用以显示在屏幕上。这个机制做了两个有效的事情来管理内存：</p>
<ol>
<li>屏幕上一次仅显示有限数量的单元格并加载到内存中</li>
<li>无论您的 UI 需要显示的项目数量有多少，您都保证拥有有限数量的单元格。</li>
</ol>
<h3 id="将单元重用机制应用于LazyVGrid"><a href="#将单元重用机制应用于LazyVGrid" class="headerlink" title="将单元重用机制应用于LazyVGrid"></a>将单元重用机制应用于LazyVGrid</h3><p>将单元格重用机制应用于<code>LazyVGrid</code>的解决方案非常简单。我们可以在<code>GridItem</code>上使用<code>.onDisappear()</code>修饰符，以便每次调用修饰符时都会释放图像。</p>
<p>为此，我们需要创建<code>GridItem</code>并将其命名为<code>PhotoThumbnailView</code> 。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Photos</span><br><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="comment">/// The photo thumbnail view is responsible for showing a photo </span></span><br><span class="line"><span class="comment">/// in the photo grid.</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PhotoThumbnailView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">	<span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>PhotoThumbnailView</code>应包含一张可选照片，我们可以稍后从内存中释放该照片。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PhotoThumbnailView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">	<span class="comment">/// The image view that will render the photo that we&#x27;ll be </span></span><br><span class="line">	<span class="comment">/// fetching. It is set to optional since we don&#x27;t have an actual </span></span><br><span class="line">	<span class="comment">/// photo when this view starts to render.</span></span><br><span class="line">    <span class="comment">/// </span></span><br><span class="line">    <span class="comment">/// We need to give time for the photo library service to </span></span><br><span class="line">    <span class="comment">/// fetch a copy of the photo using the asset id, so </span></span><br><span class="line">    <span class="comment">/// we&#x27;ll set the image with the fetched photo at a later time.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// Fetching make take time, especially if the photo has been </span></span><br><span class="line">    <span class="comment">/// requested initially. However, photos that were successfully </span></span><br><span class="line">    <span class="comment">/// fetched are cached, so any fetching from that point forward</span></span><br><span class="line">    <span class="comment">/// will be fast.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// Also, we would want to free up the image from the memory when </span></span><br><span class="line">    <span class="comment">/// this view disappears in order</span></span><br><span class="line">    <span class="comment">/// to save up memory.</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> image: <span class="type">Image</span>?</span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于我们将使用<code>PhotoKit</code>从照片库中获取照片，因此我们需要存储照片的资源本地 ID，以便我们可以告诉照片库服务我们需要它的副本才能显示到我们的 UI 中。</p>
<p>让我们将<code>PhotoLibraryService</code>添加为<code>PhotoThumbnailView</code>的依赖项。在第 1 部分中，创建<code>PhotoLibraryService</code>是为了将所有与 PhotoKit 相关的代码抽象到单个服务层中。如果您还没有阅读过，请查看本系列的第 1 部分。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PhotoThumbnailView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">	<span class="operator">...</span></span><br><span class="line">    <span class="comment">/// We&#x27;ll use the photo library service to fetch a photo given an </span></span><br><span class="line">    <span class="comment">/// asset id, and cache it for later use. If the photo is already </span></span><br><span class="line">    <span class="comment">/// cached, a cached copy will be provided instead.</span></span><br><span class="line">    <span class="comment">/// </span></span><br><span class="line">    <span class="comment">/// Ideally, we don&#x27;t want to store a reference to an image </span></span><br><span class="line">    <span class="comment">/// itself and pass it around views as it would cost memory.</span></span><br><span class="line">    <span class="comment">/// We&#x27;ll use the asset id instead as a reference, and allow the </span></span><br><span class="line">    <span class="comment">/// photo library&#x27;s cache to handle any memory management for us.</span></span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> photoLibraryService: <span class="type">PhotoLibraryService</span></span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在我们已经将照片库服务作为依赖项，我们需要添加一个属性来保存照片的本地资源 ID，我们将使用该 ID 来获取照片的副本。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PhotoThumbnailView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">	<span class="operator">...</span></span><br><span class="line">	<span class="comment">/// The reference id of the selected photo</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> assetLocalId: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="params">assetLocalId</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.assetLocalId <span class="operator">=</span> assetLocalId</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后我们将定义一个函数，该函数将使用<code>PhotoLibraryService</code>的更简单的抽象从<code>PhotoKit</code>实际加载资源。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">PhotoThumbnailView</span> &#123;</span><br><span class="line">	<span class="keyword">func</span> <span class="title function_">loadImageAsset</span>(</span><br><span class="line">		<span class="params">targetSize</span>: <span class="type">CGSize</span> <span class="operator">=</span> <span class="type">PHImageManagerMaximumSize</span></span><br><span class="line">	) <span class="keyword">async</span> &#123;</span><br><span class="line">	        <span class="keyword">guard</span> <span class="keyword">let</span> uiImage <span class="operator">=</span> <span class="keyword">try?</span> <span class="keyword">await</span> photoLibraryService</span><br><span class="line">	        .fetchImage(</span><br><span class="line">		        byLocalIdentifier: assetLocalId,</span><br><span class="line">		        targetSize: targetSize</span><br><span class="line">			) <span class="keyword">else</span> &#123;</span><br><span class="line">	            image <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line">		        <span class="keyword">return</span></span><br><span class="line">		    &#125;</span><br><span class="line">	    image <span class="operator">=</span> <span class="type">Image</span>(uiImage: uiImage)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来是创建<code>PhotoThumbnailView</code>的实际<code>body</code>并使用我们迄今为止所学到的知识，包括单元重用内存管理机制。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PhotoThumbnailView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">	<span class="operator">...</span></span><br><span class="line">	<span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ZStack</span> &#123;</span><br><span class="line">            <span class="comment">// Show the image if it&#x27;s available</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> image <span class="operator">=</span> image &#123;</span><br><span class="line">                <span class="type">GeometryReader</span> &#123; proxy <span class="keyword">in</span></span><br><span class="line">                    image</span><br><span class="line">                        .resizable()</span><br><span class="line">                        .aspectRatio(contentMode: .fill)</span><br><span class="line">                        .frame(</span><br><span class="line">	                        width: proxy.size.width, </span><br><span class="line">	                        height: proxy.size.width</span><br><span class="line">	                    )</span><br><span class="line">                        .clipped()</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// We&#x27;ll also make sure that the photo will </span></span><br><span class="line">                <span class="comment">// be square</span></span><br><span class="line">                .aspectRatio(<span class="number">1</span>, contentMode: .fit)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// Otherwise, show a gray rectangle with a </span></span><br><span class="line">                <span class="comment">// spinning progress view</span></span><br><span class="line">                <span class="type">Rectangle</span>()</span><br><span class="line">                    .foregroundColor(.gray)</span><br><span class="line">                    .aspectRatio(<span class="number">1</span>, contentMode: .fit)</span><br><span class="line">                <span class="type">ProgressView</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// We need to use the task to work on a concurrent request to </span></span><br><span class="line">        <span class="comment">// load the image from the photo library service, which </span></span><br><span class="line">        <span class="comment">// is asynchronous work.</span></span><br><span class="line">        .task &#123;</span><br><span class="line">            <span class="keyword">await</span> loadImageAsset()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Finally, when the view disappears, we need to free it </span></span><br><span class="line">        <span class="comment">// up from the memory</span></span><br><span class="line">        .onDisappear &#123;</span><br><span class="line">            image <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此照片<code>GridItem</code>从 iOS 15 开始支持并发 API，并使用内置任务支持来允许 SwiftUI 视图与并发 API 交互。当此视图加载时，视图生命周期会触发<code>loadImageAsset()</code>任务，该任务将要求 PhotoKit 使用本地资产 ID 获取照片的副本。当<code>GridItem</code>超出可视滚动区域时，图像将从内存中释放，因此它不会不必要地累积内存使用量，模仿<code>UICollectionView</code>的单元格重用机制。</p>
<p>在这篇文章中，您了解了<code>LazyVGrid</code>的内置内存管理机制，并通过添加 UIKit 视图具有的单元格重用机制改进了其内存管理行为。</p>
<p>在本系列的下一部分中，我们将继续构建网格 UI 以使用<code>PhotoThumbnailView</code>作为<code>LazyVGrid</code>的<code>GridItem</code> 。我希望您从这篇文章中学到了很多东西。我们下一场见！</p>
<h1 id="第-3-部分：创建照片库应用程序"><a href="#第-3-部分：创建照片库应用程序" class="headerlink" title="第 3 部分：创建照片库应用程序"></a>第 3 部分：创建照片库应用程序</h1><p>在这篇文章中，我们将继续构建网格 UI，以使用 PhotoThumbnailView 作为 LazyVGrid 的 GridItem，并在从网格中选择照片时导航到照片详细信息视图。</p>
<p>您好，欢迎回来！这是<strong>在 SwiftUI 中构建照片库应用程序</strong>系列的第 4 部分，共 4 部分。</p>
<p>在本系列的第 2 部分中，您了解了<code>LazyVGrid</code> （延迟加载）和<code>UICollectionView</code> （单元格重用机制）的内置内存管理机制，并使用这些知识来改进<code>LazyVGrid</code>的默认行为，以释放滚动超过的所有项目。可视区域以节省内存以免累积。</p>
<p>在这篇文章中，我们将继续构建网格 UI，以使用<code>PhotoThumbnailView</code>作为<code>LazyVGrid</code>的<code>GridItem</code> ，并在从网格中选择照片时导航到照片详细信息视图。</p>
<h3 id="图书馆景观"><a href="#图书馆景观" class="headerlink" title="图书馆景观"></a>图书馆景观</h3><img src="https://user-images.githubusercontent.com/106976715/189639356-ab043d14-b5ac-4217-a19f-cd655f43ef33.png" width="360" alt="simulator_screenshot_5BB5921D-1BD7-4BAE-BDF1-98EEAA11C7A4">

<p>库视图使用包含在<code>ScrollView</code>中的<code>LazyVGrid</code> ，因此它是可滚动的。对于每个照片项目，我们将使用我们在本系列的第 2 部分中创建的<code>PhotoThumbnailView</code> 。为了让您快速回顾一下， <code>PhotoThumbnailView</code>使用 PhotoKit 从库中获取照片，并在不再需要时释放照片以避免内存使用的累积。我们可以保证，当<code>PhotoThumbnailView</code>显示在屏幕上时，它会为我们获取并显示照片，并且当它滚动经过可视区域时，它将从内存中释放。</p>
<p>首先，我们首先在 SwiftUI 中创建<code>PhotoLibraryView</code> ：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PhotoLibraryView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">	<span class="operator">...</span>	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们需要添加<code>PhotoLibraryService</code> ，因为我们需要请求用户授予访问用户照片库的权限。一旦获得许可，我们将使用<code>PhotoLibraryService</code>通过 PhotoKit 从库中获取所有照片引用。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PhotoLibraryView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">	<span class="operator">...</span></span><br><span class="line">	<span class="comment">/// Photo library will ask for permission to ask the user for </span></span><br><span class="line">	<span class="comment">/// Photo access, and will provide the photos as well.</span></span><br><span class="line">    <span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> photoLibraryService: <span class="type">PhotoLibraryService</span></span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用户可能会撤销或拒绝对照片库的访问，我们也必须能够在 UI 上处理此问题。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PhotoLibraryView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">	<span class="operator">...</span></span><br><span class="line">    <span class="comment">/// Frag that will show the error prompt if the user does not </span></span><br><span class="line">    <span class="comment">/// grant the app Photo access.</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showErrorPrompt <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，我们添加代码，显示访问照片库的提示，并正确处理用户拒绝访问照片库时的情况。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">PhotoLibraryView</span> &#123;</span><br><span class="line">	<span class="keyword">func</span> <span class="title function_">requestForAuthorizationIfNecessary</span>() &#123;</span><br><span class="line">        <span class="comment">// Make sure that the access granted by the user is </span></span><br><span class="line">        <span class="comment">// authorized, or limited access to make the app work. As </span></span><br><span class="line">        <span class="comment">// long as access is granted, even when limited, we can have </span></span><br><span class="line">        <span class="comment">// the photo library fetch the photos to be shown in the app.</span></span><br><span class="line">        <span class="keyword">guard</span> photoLibraryService.authorizationStatus <span class="operator">!=</span> .authorized <span class="operator">||</span></span><br><span class="line">                photoLibraryService.authorizationStatus <span class="operator">!=</span> .limited</span><br><span class="line">        <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">        photoLibraryService.requestAuthorization &#123; error <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">guard</span> error <span class="operator">!=</span> <span class="literal">nil</span> <span class="keyword">else</span> &#123; <span class="keyword">return</span> &#125;</span><br><span class="line">            showErrorPrompt <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来要做的就是创建 UI 本身。为了便于阅读，我们将其作为计算属性来执行。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">PhotoLibraryView</span> &#123;</span><br><span class="line">	<span class="keyword">var</span> libraryView: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ScrollView</span> &#123;</span><br><span class="line">            <span class="type">LazyVGrid</span>(</span><br><span class="line">	            <span class="comment">/// We&#x27;ll set a 3-column row with an adaptive width</span></span><br><span class="line">	            <span class="comment">/// of 100 for each grid item, and give it a spacing</span></span><br><span class="line">	            <span class="comment">/// of 1 pixel in between columns and in between rows</span></span><br><span class="line">                columns: <span class="type">Array</span>(</span><br><span class="line">	                repeating: .<span class="keyword">init</span>(.adaptive(minimum: <span class="number">100</span>), spacing: <span class="number">1</span>), </span><br><span class="line">		            count: <span class="number">3</span></span><br><span class="line">		        ),</span><br><span class="line">                spacing: <span class="number">1</span></span><br><span class="line">            ) &#123;</span><br><span class="line">	            <span class="comment">/// We&#x27;ll go through the photo references fetched by</span></span><br><span class="line">	            <span class="comment">/// the photo gallery and give a photo asset ID</span></span><br><span class="line">	            <span class="comment">/// into the PhotoThumbnailView so it knows what</span></span><br><span class="line">	            <span class="comment">/// image to load and show into the grid</span></span><br><span class="line">                <span class="type">ForEach</span>(photoLibraryService.results, id: \.<span class="keyword">self</span>) &#123; asset <span class="keyword">in</span></span><br><span class="line">	                <span class="comment">/// Wrap the PhotoThumbnailView into a button</span></span><br><span class="line">	                <span class="comment">/// so we can tap on it without overlapping</span></span><br><span class="line">	                <span class="comment">/// the tap area of each photo, as photos have</span></span><br><span class="line">	                <span class="comment">/// their aspect ratios, and may go out of</span></span><br><span class="line">	                <span class="comment">/// bounds of the square view.</span></span><br><span class="line">                    <span class="type">Button</span> &#123;</span><br><span class="line">						<span class="comment">// <span class="doctag">TODO:</span> Add tapping action here</span></span><br><span class="line">                    &#125; label: &#123;</span><br><span class="line">                        <span class="type">PhotoThumbnailView</span>(assetLocalId: asset.localIdentifier)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后将<code>libraryView</code>属性添加到<code>PhotoLibraryView</code>的<code>body</code>中。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PhotoLibraryView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">	<span class="operator">...</span></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ZStack</span> &#123;</span><br><span class="line">            <span class="comment">// We&#x27;ll show the photo library in a grid</span></span><br><span class="line">            libraryView</span><br><span class="line">                .onAppear &#123;</span><br><span class="line">                    <span class="comment">// But first we need to make sure we got </span></span><br><span class="line">                    <span class="comment">// permission to Access the Photos library</span></span><br><span class="line">                    requestForAuthorizationIfNecessary()</span><br><span class="line">                &#125;</span><br><span class="line">                .alert(</span><br><span class="line">                    <span class="comment">// If in case the user won&#x27;t grant permission, </span></span><br><span class="line">                    <span class="comment">// we&#x27;ll show an alert to notify the user that </span></span><br><span class="line">                    <span class="comment">// access is required to use the app.</span></span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;This app requires photo library access to show your photos&quot;</span>),</span><br><span class="line">                    isPresented: <span class="variable">$showErrorPrompt</span></span><br><span class="line">                ) &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在我们有了库视图，继续尝试在手机或模拟器中运行该应用程序。如果您授予照片库访问权限，您应该能够在应用程序上查看您的照片。</p>
<h3 id="详细视图"><a href="#详细视图" class="headerlink" title="详细视图"></a>详细视图</h3><p>详细视图将是另一个 SwiftUI，它将转换从<code>PhotoLibraryView</code>中选择的照片。所选照片将集中在详细视图上。在本系列的下一部分中，我们将向详细视图添加更多功能，但现在让我们创建 UI。我们将详细视图称为<code>PhotoDetailView</code> 。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PhotoDetailView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">	<span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>正如本系列第 1 部分中所讨论的，我们应该避免传递实际照片本身，而应该在视图之间传递照片引用。我们之前已经在<code>PhotoLibraryView</code>和<code>PhotoThumbnailView</code>上实现了这种方法。 <code>PhotoLibraryView</code>将告诉 PhotoKit 通过<code>PhotoLibraryService</code>获取所有照片引用，并且每个<code>PhotoThumbnailView</code>都可以访问本地照片资源 ID。然后， <code>PhotoThumbnailView</code>使用本地资产 ID 使用<code>PhotoLibraryService</code>的抽象从 PhotoKit 获取实际照片本身。</p>
<p>使用相同的方法，我们需要将照片本地资产 ID 从<code>PhotoLibraryView</code>传递到<code>PhotoDetailView</code>中，并让<code>PhotoDetailView</code>使用<code>PhotoLibraryService</code>获取照片的缓存副本。</p>
<p>让我们首先将<code>PhotoLibraryService</code>添加到<code>PhotoDetailView</code>中。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PhotoDetailView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">	<span class="meta">@EnvironmentObject</span> <span class="keyword">var</span> photoLibraryService: <span class="type">PhotoLibraryService</span></span><br><span class="line">	<span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还添加了使用资产本地 ID 获取照片本身的缓存副本的功能。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">PhotoDetailView</span> &#123;</span><br><span class="line">	<span class="keyword">func</span> <span class="title function_">loadImageAsset</span>() <span class="keyword">async</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> uiImage <span class="operator">=</span> <span class="keyword">try?</span> <span class="keyword">await</span> photoLibraryService.fetchImage(</span><br><span class="line">            byLocalIdentifier: assetLocalId</span><br><span class="line">        ) <span class="keyword">else</span> &#123;</span><br><span class="line">            image <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        image <span class="operator">=</span> <span class="type">Image</span>(uiImage: uiImage)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，我们将添加一个属性，该属性可以保存对照片资源本地 ID 的引用，以便它知道要使用<code>PhotoLibraryService</code>获取哪些照片。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PhotoDetailView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">	<span class="operator">...</span></span><br><span class="line">    <span class="comment">/// The reference id of the selected photo</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> assetLocalId: <span class="type">PhotoLibraryService</span>.<span class="type">PHAssetLocalIdentifier</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(</span><br><span class="line">        <span class="params">assetLocalId</span>: <span class="type">PhotoLibraryService</span>.<span class="type">PHAssetLocalIdentifier</span></span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">self</span>.assetLocalId <span class="operator">=</span> assetLocalId</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们还想添加一个可选<code>Image</code> ，因为在<code>PhotoLibraryService</code>完成获取图像的缓存副本之前，我们不一定要显示照片的副本。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PhotoDetailView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="comment">/// The image view that will render the photo that we&#x27;ll fetch </span></span><br><span class="line">    <span class="comment">/// later on. It is set to optional since we don&#x27;t have an actual </span></span><br><span class="line">    <span class="comment">/// photo when this scene starts to render. We need to give time </span></span><br><span class="line">    <span class="comment">/// for the photo library service to fetch a cached copy</span></span><br><span class="line">    <span class="comment">/// of the photo using the asset id, so we&#x27;ll set the image with </span></span><br><span class="line">    <span class="comment">/// the fetching photo at a later time.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// Fetching is generally fast, as photos are cached at this </span></span><br><span class="line">    <span class="comment">/// point. So you don&#x27;t need to worry about photo rendering.</span></span><br><span class="line">    <span class="comment">///</span></span><br><span class="line">    <span class="comment">/// Also, we would want to free up the image from the memory when </span></span><br><span class="line">    <span class="comment">/// this view disappears to save up memory.</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> image: <span class="type">Image</span>?</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于 UI，我们将创建<code>photoView</code>并将其作为计算属性以提高可读性。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">PhotoDetailView</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> photoView: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">GeometryReader</span> &#123; proxy <span class="keyword">in</span></span><br><span class="line">            image<span class="operator">?</span></span><br><span class="line">                .resizable()</span><br><span class="line">                .aspectRatio(contentMode: .fit)</span><br><span class="line">                .frame(width: proxy.size.width <span class="operator">*</span> <span class="built_in">max</span>(minZoomScale, zoomScale))</span><br><span class="line">                .frame(maxHeight: .infinity)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后我们将在<code>PhotoDetailView</code> <code>body</code>内使用<code>photoView</code> 。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PhotoDetailView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ZStack</span> &#123;</span><br><span class="line">            <span class="comment">// We&#x27;ll need a black background regardless of the </span></span><br><span class="line">            <span class="comment">// environment&#x27;s colour scheme.</span></span><br><span class="line">            <span class="type">Color</span>.black</span><br><span class="line">                .ignoresSafeArea()</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Show the image if it&#x27;s available</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> <span class="keyword">_</span> <span class="operator">=</span> image &#123;</span><br><span class="line">                photoView</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// otherwise, show a spinning progress view</span></span><br><span class="line">                <span class="type">ProgressView</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// We need to use the task to work on a concurrent request to </span></span><br><span class="line">        <span class="comment">// load the image from the photo library service, which is an </span></span><br><span class="line">        <span class="comment">// asynchronous work.</span></span><br><span class="line">        .task &#123;</span><br><span class="line">            <span class="keyword">await</span> loadImageAsset()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Finally, when the view disappears, we need to free it up </span></span><br><span class="line">        <span class="comment">// from the memory</span></span><br><span class="line">        .onDisappear &#123;</span><br><span class="line">            image <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="选择照片并进行过渡"><a href="#选择照片并进行过渡" class="headerlink" title="选择照片并进行过渡"></a>选择照片并进行过渡</h3><p>现在我们已经有了<code>PhotoLibraryView</code>和<code>PhotoDetailView</code> ，我们需要在选择照片时在两个视图之间添加过渡。</p>
<p>让我们首先向<code>PhotoDetailView</code>添加必要的更改</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PhotoDetailView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">	<span class="operator">...</span></span><br><span class="line">	<span class="comment">/// Flag that will close the detail view if set to false</span></span><br><span class="line">    <span class="meta">@Binding</span> <span class="keyword">var</span> showDetailView: <span class="type">Bool</span></span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">    <span class="comment">/// Update your init to accept showDetailView binding</span></span><br><span class="line">	<span class="keyword">init</span>(</span><br><span class="line">        <span class="params">assetLocalId</span>: <span class="type">PhotoLibraryService</span>.<span class="type">PHAssetLocalIdentifier</span>,</span><br><span class="line">        <span class="params">showDetailView</span>: <span class="type">Binding</span>&lt;<span class="type">Bool</span>&gt;</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">self</span>.assetLocalId <span class="operator">=</span> assetLocalId</span><br><span class="line">        <span class="keyword">self</span>._showDetailView <span class="operator">=</span> showDetailView</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，我们还需要为关闭按钮添加其他子视图，以便在按下关闭按钮时可以从<code>PhotoDetailView</code>转换回<code>PhotoLibraryView</code> 。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">PhotoDetailView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">	<span class="keyword">var</span> photoView: <span class="keyword">some</span> <span class="type">View</span> &#123; <span class="operator">...</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> toolbarView: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span> &#123;</span><br><span class="line">            closeButton</span><br><span class="line">        &#125;</span><br><span class="line">        .frame(maxWidth: .infinity, alignment: .trailing)</span><br><span class="line">        .padding(.horizontal, <span class="number">20</span>)</span><br><span class="line">        .frame(height: <span class="number">44</span>)</span><br><span class="line">        .frame(maxHeight: .infinity, alignment: .top)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> closeButton: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Button</span> &#123;</span><br><span class="line">            showDetailView <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line">        &#125; label: &#123;</span><br><span class="line">            <span class="type">Image</span>(systemName: <span class="string">&quot;xmark&quot;</span>)</span><br><span class="line">                .font(.body.bold())</span><br><span class="line">                .aspectRatio(contentMode: .fit)</span><br><span class="line">                .foregroundColor(.white)</span><br><span class="line">                .frame(width: <span class="number">16</span>, height: <span class="number">16</span>)</span><br><span class="line">                .padding(.all, <span class="number">12</span>)</span><br><span class="line">                .background(.ultraThinMaterial, in: <span class="type">Circle</span>())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，我们将工具栏添加到<code>body</code>中，以便当<code>PhotoDetailView</code>显示在屏幕上时它将包含在内。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PhotoDetailView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">	<span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ZStack</span> &#123;</span><br><span class="line">            <span class="comment">// We&#x27;ll need a black background regardless of the </span></span><br><span class="line">            <span class="comment">// environment&#x27;s colour scheme.</span></span><br><span class="line">            <span class="type">Color</span>.black</span><br><span class="line">                .ignoresSafeArea()</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Show the image if it&#x27;s available</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> <span class="keyword">_</span> <span class="operator">=</span> image &#123;</span><br><span class="line">                photoView</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// otherwise, show a spinning progress view</span></span><br><span class="line">                <span class="type">ProgressView</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// The toolbar view holds the close button</span></span><br><span class="line">        .overlay(</span><br><span class="line">            toolbarView</span><br><span class="line">        )</span><br><span class="line">        <span class="comment">// We need to use a task to work on a concurrent request to </span></span><br><span class="line">        <span class="comment">// load the image from the photo library service, which is an </span></span><br><span class="line">        <span class="comment">// asynchronous work.</span></span><br><span class="line">        .task &#123;</span><br><span class="line">            <span class="keyword">await</span> loadImageAsset()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Finally, when the view disappears, we need to free it up </span></span><br><span class="line">        <span class="comment">// from the memory</span></span><br><span class="line">        .onDisappear &#123;</span><br><span class="line">            image <span class="operator">=</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>让我们回到<code>PhotoLibraryView</code>以便我们也可以对过渡进行更改。</p>
<p>我们首先添加一个新的<code>Boolean</code>状态（用于确定是否显示<code>PhotoDetailView</code> ，以及一个用于保存所选照片的照片资源 ID 引用的状态。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PhotoLibraryView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">	<span class="operator">...</span></span><br><span class="line">    <span class="comment">/// Flag that will show the detail view when a photo is selected </span></span><br><span class="line">    <span class="comment">/// from the grid.</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> showDetailView <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Selecting a photo from the grid will show a detail view where </span></span><br><span class="line">    <span class="comment">/// the user can zoom/pan.</span></span><br><span class="line">    <span class="comment">/// To do so, we store a reference to the selected photo </span></span><br><span class="line">    <span class="comment">/// here.</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> selectedPhotoAssetId: <span class="type">PhotoLibraryService</span>.<span class="type">PHAssetLocalIdentifier</span> <span class="operator">=</span> .empty</span><br><span class="line">	<span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们需要为<code>PhotoDetailView</code>添加一个新的子视图，这样当从网格中选择照片时，我们就可以将其放在<code>ZStack</code>的顶部。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">PhotoLibraryView</span> &#123;</span><br><span class="line">	<span class="keyword">var</span> libraryView: <span class="keyword">some</span> <span class="type">View</span> &#123; <span class="operator">...</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> detailView: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ForEach</span>(photoLibraryService.results, id: \.<span class="keyword">self</span>) &#123; asset <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">if</span> asset.localIdentifier <span class="operator">==</span> selectedPhotoAssetId &#123;</span><br><span class="line">                <span class="type">PhotoDetailView</span>(</span><br><span class="line">                    assetLocalId: selectedPhotoAssetId,</span><br><span class="line">                    showDetailView: <span class="variable">$showDetailView</span></span><br><span class="line">                )</span><br><span class="line">                <span class="comment">// We need to make sure that the detail view gets the </span></span><br><span class="line">                <span class="comment">// top layer of the ZStack when rendering. We don&#x27;t </span></span><br><span class="line">                <span class="comment">// want to hide the detail view underneath the photo </span></span><br><span class="line">                <span class="comment">// grid when we select a photo. So we&#x27;ll assign it a </span></span><br><span class="line">                <span class="comment">// higher zIndex value.</span></span><br><span class="line">                .zIndex(<span class="number">1</span>)</span><br><span class="line">                <span class="comment">// We would also want to add a small transition </span></span><br><span class="line">                <span class="comment">// easeIn/easeOut animations during the</span></span><br><span class="line">                <span class="comment">// photo grid to detail view transition and vice </span></span><br><span class="line">                <span class="comment">// versa.</span></span><br><span class="line">                .transition(</span><br><span class="line">                    .asymmetric(</span><br><span class="line">                        insertion: .opacity.animation(.easeIn),</span><br><span class="line">                        removal: .opacity.animation(.easeOut)</span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们还需要更新<code>libraryView</code>以在从照片网格中点击<code>PhotoThumbnailView</code>时设置一些<code>Button</code>操作。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">PhotoLibraryView</span> &#123;</span><br><span class="line">	<span class="keyword">var</span> libraryView: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ScrollView</span> &#123;</span><br><span class="line">            <span class="type">LazyVGrid</span>(<span class="operator">...</span>) &#123;</span><br><span class="line">                <span class="type">ForEach</span>(photoLibraryService.results, id: \.<span class="keyword">self</span>) &#123; asset <span class="keyword">in</span></span><br><span class="line">                    <span class="type">Button</span> &#123;</span><br><span class="line">						<span class="comment">/// Add them here</span></span><br><span class="line">                        showDetailView <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">                        selectedPhotoAssetId <span class="operator">=</span> asset.localIdentifier				</span><br><span class="line">                    &#125; label: &#123;</span><br><span class="line">                        <span class="type">PhotoThumbnailView</span>(assetLocalId: asset.localIdentifier)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> detailView: <span class="keyword">some</span> <span class="type">View</span> &#123; <span class="operator">...</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后，当从网格中选择照片时，我们需要将<code>PhotoDetailView</code>包含在<code>PhotoLibraryView</code>的<code>ZStack</code>中。为此，我们需要更新<code>body</code>以包括：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PhotoLibraryView</span>: <span class="title class_">some</span> <span class="title class_">View</span> &#123;</span><br><span class="line">	<span class="operator">...</span></span><br><span class="line">	<span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">		<span class="type">ZStack</span> &#123;</span><br><span class="line">			libraryView</span><br><span class="line">				.onAppear &#123; <span class="operator">...</span> &#125;</span><br><span class="line">				.alert(<span class="operator">...</span>) &#123;&#125;</span><br><span class="line">			</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// We&#x27;ll show the detail view on top of the ZStack if a </span></span><br><span class="line">            <span class="comment">// photo is selected</span></span><br><span class="line">            <span class="keyword">if</span> showDetailView &#123;</span><br><span class="line">                detailView</span><br><span class="line">            &#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时您可以尝试再次运行该应用程序，并且您应该能够从网格中选择一张照片。所选照片应显示在<code>PhotoDetailView</code>中，当您按返回时，您还应导航回<code>PhotoLibraryView</code> 。</p>
<p>在这篇文章中，我们整理了之前构建的内容并为照片库应用程序创建了 UI。我们现在有了一个内存高性能照片网格，并且我们还确保通过引用传递照片不会导致我们的内存出现任何重复。</p>
<p>在本系列的下一部分也是最后一部分中，我将向您展示如何添加多个手势，以便我们可以提供双击缩放、捏合缩放和平移照片等功能。我希望到目前为止您喜欢阅读该系列。我们下一场见！</p>
<h1 id="第-4-部分：添加多个手势"><a href="#第-4-部分：添加多个手势" class="headerlink" title="第 4 部分：添加多个手势"></a>第 4 部分：添加多个手势</h1><p>在这篇文章中，我将向您展示如何添加多个手势，以便我们可以提供双击缩放、捏合缩放和平移照片等功能。</p>
<p>您好，欢迎回来！这是<strong>在 SwiftUI 中构建照片库应用程序</strong>系列的最后一部分。</p>
<p>在本系列的第 3 部分中，我们已经完成了照片库应用程序的 UI，其中包含显示照片网格的<code>PhotoLibraryView</code> 、作为<code>GridItem</code>的<code>PhotoThumbnailView</code>以及专注于从网格中选择的图像的<code>PhotoDetailView</code> 。但是， <code>PhotoDetailView</code>缺乏手势支持，并且我们没有任何用于检查照片的交互支持，例如缩放或平移。如果不支持这些手势，照片库应用程序就不完整。</p>
<p>在这篇文章中，我将向您展示如何添加多个手势，以便我们可以提供双击缩放、捏合缩放和平移照片等功能。</p>
<h3 id="双击缩放"><a href="#双击缩放" class="headerlink" title="双击缩放"></a>双击缩放</h3><p>添加对双击缩放的支持非常容易。我们首先需要添加<code>@State</code>属性，用于存储<code>zoomScale</code>值，以便我们可以判断照片是否缩放以及对照片应用了多少缩放。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PhotoDetailView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">	<span class="operator">...</span></span><br><span class="line">    <span class="comment">/// Zooming value modifiers that are set by pinching to zoom </span></span><br><span class="line">    <span class="comment">/// gestures</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> zoomScale: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> previousZoomScale: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> minZoomScale: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> maxZoomScale: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">5</span></span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>让我们创建一个函数，在收到双击手势时缩放照片，并将缩放状态重置回正常状态。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">PhotoDetailView</span> &#123;</span><br><span class="line">	<span class="comment">/// Resets the zoom scale back to 1 – the photo scale at 1x zoom</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">resetImageState</span>() &#123;</span><br><span class="line">        withAnimation(.interactiveSpring()) &#123;</span><br><span class="line">            zoomScale <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/// On double tap</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">onImageDoubleTapped</span>() &#123;</span><br><span class="line">	    <span class="comment">/// Zoom the photo to 5x scale if the photo isn&#x27;t zoomed in</span></span><br><span class="line">        <span class="keyword">if</span> zoomScale <span class="operator">==</span> <span class="number">1</span> &#123;</span><br><span class="line">            withAnimation(.spring()) &#123;</span><br><span class="line">                zoomScale <span class="operator">=</span> <span class="number">5</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	        <span class="comment">/// Otherwise, reset the photo zoom to 1x</span></span><br><span class="line">            resetImageState()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，我们将使用<code>onTapGesture(count, perform)</code>函数向<code>photoView</code>添加对双击手势的支持。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">PhotoDetailView</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> photoView: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">GeometryReader</span> &#123; proxy <span class="keyword">in</span></span><br><span class="line">            image<span class="operator">?</span></span><br><span class="line">                .resizable()</span><br><span class="line">                .aspectRatio(contentMode: .fit)</span><br><span class="line">                .onTapGesture(count: <span class="number">2</span>, perform: onImageDoubleTapped)</span><br><span class="line">                .frame(width: proxy.size.width <span class="operator">*</span> <span class="built_in">max</span>(minZoomScale, zoomScale))</span><br><span class="line">                .frame(maxHeight: .infinity)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行应用程序并双击<code>PhotoDetailView</code>上的照片。您会注意到它会在缩放状态和正常状态之间来回切换。</p>
<p>接下来是添加对捏合缩放手势的支持。 SwiftUI 通过一个名为<code>MagnificationGesture</code>的内置手势默认支持捏合手势，这是一件很棒的事情，并且添加它很容易。</p>
<p>在将<code>MagnificationGesture</code>添加到<code>photoView</code>之前，我们首先需要定义<code>MagnificationGesture</code>行为所需的函数。</p>
<p>要使用<code>MagnificationGesture</code> ，我们需要定义手势开始和结束时其行为。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">PhotoDetailView</span> &#123;</span><br><span class="line">	<span class="operator">...</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">onZoomGestureStarted</span>(<span class="params">value</span>: <span class="type">MagnificationGesture</span>.<span class="type">Value</span>) &#123;</span><br><span class="line">        withAnimation(.easeIn(duration: <span class="number">0.1</span>)) &#123;</span><br><span class="line">            <span class="keyword">let</span> delta <span class="operator">=</span> value <span class="operator">/</span> previousZoomScale</span><br><span class="line">            previousZoomScale <span class="operator">=</span> value</span><br><span class="line">            <span class="keyword">let</span> zoomDelta <span class="operator">=</span> zoomScale <span class="operator">*</span> delta</span><br><span class="line">            <span class="keyword">var</span> minMaxScale <span class="operator">=</span> <span class="built_in">max</span>(minZoomScale, zoomDelta)</span><br><span class="line">            minMaxScale <span class="operator">=</span> <span class="built_in">min</span>(maxZoomScale, minMaxScale)</span><br><span class="line">            zoomScale <span class="operator">=</span> minMaxScale</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">onZoomGestureEnded</span>(<span class="params">value</span>: <span class="type">MagnificationGesture</span>) &#123;</span><br><span class="line">        previousZoomScale <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> zoomScale <span class="operator">&lt;=</span> <span class="number">1</span> &#123;</span><br><span class="line">            resetImageState()</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> zoomScale <span class="operator">&gt;</span> <span class="number">5</span> &#123;</span><br><span class="line">            zoomScale <span class="operator">=</span> <span class="number">5</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="operator">...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当手势开始时，我们将计算<code>zoomScale</code>以接受 1 倍原始比例和 5 倍缩放比例之间的值。我们不允许任何低于原始比例的值，以及任何大于缩放比例的值。</p>
<p>整个计算包含在<code>withAnimation()</code>闭包中，因此我们可以告诉 SwiftUI 我们需要在每次手势变化时平滑地设置缩放行为的动画。</p>
<p>当手势结束时，我们将保留<code>zoomScale</code> ，以便我们的照片根据手势输入进行缩放。</p>
<p>现在我们有了<code>onZoomGestureStarted</code>和<code>onZoomGestureEnded</code>函数来定义我们想要的行为，让我们将它们添加到<code>MagnificationGesture</code>对象上，并将其命名为<code>zoomGesture</code> 。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">PhotoDetailView</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> zoomGesture: <span class="keyword">some</span> <span class="type">Gesture</span> &#123;</span><br><span class="line">        <span class="type">MagnificationGesture</span>()</span><br><span class="line">            .onChanged(onZoomGestureStarted)</span><br><span class="line">            .onEnded(onZoomGestureEnded)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后将其作为手势添加到<code>photoView</code>中，如下所示：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">PhotoDetailView</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> photoView: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">GeometryReader</span> &#123; proxy <span class="keyword">in</span></span><br><span class="line">            image<span class="operator">?</span></span><br><span class="line">                .resizable()</span><br><span class="line">                .aspectRatio(contentMode: .fit)</span><br><span class="line">                .onTapGesture(count: <span class="number">2</span>, perform: onImageDoubleTapped)</span><br><span class="line">                .gesture(zoomGesture) <span class="comment">// Add it here</span></span><br><span class="line">                .frame(width: proxy.size.width <span class="operator">*</span> <span class="built_in">max</span>(minZoomScale, zoomScale))</span><br><span class="line">                .frame(maxHeight: .infinity)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再次运行该应用程序，您应该能够捏合屏幕并进行缩放。但是，您可能已经注意到，您无法在滑动时平移或滚动照片以移动。为此，您可以添加<code>DragGesture</code>来存储拖动偏移，并将其应用到<code>photoView.offSet</code>修改器，以便它沿着您的平移手势移动。</p>
<p>但是，根据经验，这不是一个理想的解决方案，因为管理有关<code>PhotoDetailView</code>边界的照片偏移会很困难。您将需要根据<code>PhotoDetailView</code>的边界进行计算，以便<code>photoView</code>不会超出边界。</p>
<h3 id="添加-DragGesture-以支持平移（不推荐）"><a href="#添加-DragGesture-以支持平移（不推荐）" class="headerlink" title="添加 DragGesture 以支持平移（不推荐）"></a>添加 DragGesture 以支持平移（不推荐）</h3><p>您无需按照我的说明操作下面的示例，因为该示例仅向您展示如果您选择实现<code>DragGesture</code>来添加平移手势支持，会出现什么问题。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">PhotoDetailView</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">	<span class="operator">...</span></span><br><span class="line">	<span class="comment">// Add a new dragOffset property to store your drag gesture</span></span><br><span class="line">	<span class="comment">// movement updates</span></span><br><span class="line">	<span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> dragOffset: <span class="type">CGSize</span> <span class="operator">=</span> .zero</span><br><span class="line">	<span class="operator">...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extension</span> <span class="title class_">PhotoDetailView</span> &#123;</span><br><span class="line">	<span class="operator">...</span>   </span><br><span class="line">	<span class="comment">// Then declare a function that will store the new offset</span></span><br><span class="line">	<span class="comment">// based on the actual movement of the user</span></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">onDragGestureStarted</span>(<span class="params">value</span>: <span class="type">DragGesture</span>.<span class="type">Value</span>) &#123;</span><br><span class="line">        withAnimation(.easeIn(duration: <span class="number">0.1</span>)) &#123;</span><br><span class="line">            dragOffset <span class="operator">=</span> value.translation</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Declare the `DragGesture` object, and assign the drag changed</span></span><br><span class="line">	<span class="comment">// behaviour above.</span></span><br><span class="line">	<span class="keyword">var</span> panGesture: <span class="keyword">some</span> <span class="type">Gesture</span> &#123;</span><br><span class="line">		<span class="type">DragGesture</span>()</span><br><span class="line">			.onChanged(onDragGestureStarted)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Lastly, assign the pan gesture to the `photoView`</span></span><br><span class="line">    <span class="keyword">var</span> photoView: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">GeometryReader</span> &#123; proxy <span class="keyword">in</span></span><br><span class="line">            image<span class="operator">?</span></span><br><span class="line">                .resizable()</span><br><span class="line">                .aspectRatio(contentMode: .fit)</span><br><span class="line">                .onTapGesture(count: <span class="number">2</span>, perform: onImageDoubleTapped)</span><br><span class="line">                .gesture(panGesture) <span class="comment">// Add it here</span></span><br><span class="line">                .gesture(zoomGesture)</span><br><span class="line">                .frame(width: proxy.size.width <span class="operator">*</span> <span class="built_in">max</span>(minZoomScale, zoomScale))</span><br><span class="line">                .frame(maxHeight: .infinity)</span><br><span class="line">                .offset(dragOffset)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行应用程序然后观察。放大照片，然后朝您想要移动的方向滑动照片来执行平移手势。</p>
<p>照片应跟随您的拖动移动，但每次您释放拖动移动时，拖动偏移都会将照片移动到新位置。如果将照片移动到边缘，您会注意到照片可能会超出视图范围，这是我们不希望发生的情况。</p>
<img src="https://user-images.githubusercontent.com/106976715/190696381-a2ff87d0-c2cf-4a37-b558-cc8a812ab380.png" width="360" alt="Simulator Screen Shot - iPhone 13 mini - 2022-09-17 at 01 24 58">

<p>这是使用<code>DragGesture</code>实现的照片示例，滑动到照片的左上角，您可以看到顶部超出了视图容器顶部的范围。</p>
<h3 id="用-ScrollView-包裹它（推荐）"><a href="#用-ScrollView-包裹它（推荐）" class="headerlink" title="用 ScrollView 包裹它（推荐）"></a>用 ScrollView 包裹它（推荐）</h3><p>如果您想以最少的努力获得相同的结果，可以通过将<code>photoView</code>的<code>image</code>包装在<code>ScrollView</code>中并将滚动方向设置为<code>.horizontal</code>和<code>.vertical</code>来实现。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extension</span> <span class="title class_">PhotoDetailView</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> photoView: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">GeometryReader</span> &#123; proxy <span class="keyword">in</span></span><br><span class="line">	        <span class="comment">// Wrap the image with a scroll view.</span></span><br><span class="line">	        <span class="comment">// Doing so would limit the photo scroll within the</span></span><br><span class="line">	        <span class="comment">// bounds of the scroll view, but will still have</span></span><br><span class="line">	        <span class="comment">// the same functionality of adding pan gesture support.</span></span><br><span class="line">            <span class="type">ScrollView</span>(</span><br><span class="line">                [.vertical, .horizontal],</span><br><span class="line">                showsIndicators: <span class="literal">false</span></span><br><span class="line">            ) &#123;</span><br><span class="line">                image<span class="operator">?</span></span><br><span class="line">                    .resizable()</span><br><span class="line">                    .aspectRatio(contentMode: .fit)</span><br><span class="line">                    .onTapGesture(count: <span class="number">2</span>, perform: onImageDoubleTapped)</span><br><span class="line">                    .gesture(zoomGesture)</span><br><span class="line">                    .frame(width: proxy.size.width <span class="operator">*</span> <span class="built_in">max</span>(minZoomScale, zoomScale))</span><br><span class="line">                    .frame(maxHeight: .infinity)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再次运行应用程序，然后缩放照片。您应该能够滚动照片，同时将相框限制在其容器视图的范围内。将<code>image</code>包装到<code>ScrollView</code>中是解决相框和视图边界计算等复杂问题的极其简单的解决方案。</p>
<h3 id="您在开始开发照片库应用程序时需要帮助吗？"><a href="#您在开始开发照片库应用程序时需要帮助吗？" class="headerlink" title="您在开始开发照片库应用程序时需要帮助吗？"></a>您在开始开发照片库应用程序时需要帮助吗？</h3><p>如果您需要创建一个像本系列中的照片库应用程序，但您不确定如何自己开始，那么您可以购买我们的 CWC 代码套件之一。</p>
<p>照片库应用程序代码套件包含我们在本系列中讨论的所有内存管理最佳实践，并且是用 100% SwiftUI 编写的。您将从具有完整基本功能（包括内存性能）的照片库应用程序开始，这样您就可以专注于添加更多功能并使其成为您自己的！</p>
<p>我们还有适用于其他应用程序的套件，因此请在<a target="_blank" rel="noopener" href="https://codewithchris.wpengine.com/kits/">https://codewithchris.wpengine.com/kits</a>上查看我们的代码和设计套件。</p>
<p>本系列的最后一部分到此结束，我希望您已经学会了如何在 SwiftUI 中创建照片库应用程序！这是一段相当长的旅程，祝贺您走到这一步。希望您喜欢这个系列！感谢您的阅读！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/10/28/%E5%9C%A8%20SwiftUI%20%E4%B8%AD%E6%9E%84%E5%BB%BA%E7%85%A7%E7%89%87%E5%BA%93%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/" data-id="cm6swutiu002w8q746om37hbs" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-在SwiftUI中如何计算代码的执行时间？" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/08/19/%E5%9C%A8SwiftUI%E4%B8%AD%E5%A6%82%E4%BD%95%E8%AE%A1%E7%AE%97%E4%BB%A3%E7%A0%81%E7%9A%84%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4%EF%BC%9F/" class="article-date">
  <time class="dt-published" datetime="2024-08-19T00:43:10.000Z" itemprop="datePublished">2024-08-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/08/19/%E5%9C%A8SwiftUI%E4%B8%AD%E5%A6%82%E4%BD%95%E8%AE%A1%E7%AE%97%E4%BB%A3%E7%A0%81%E7%9A%84%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4%EF%BC%9F/">在SwiftUI中如何计算代码的执行时间？</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在Swift中，可以通过使用<code>Date</code>类来测量一段代码的执行时间。以下是一个简单的示例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> startTime <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里放置你想测量执行时间的代码</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span><span class="number">1000</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> endTime <span class="operator">=</span> <span class="type">Date</span>()</span><br><span class="line"><span class="keyword">let</span> executionTime <span class="operator">=</span> endTime.timeIntervalSince(startTime)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;代码执行时间: <span class="subst">\(executionTime)</span> 秒&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h3><ol>
<li><code>let startTime = Date()</code>：记录代码开始执行的时间。</li>
<li>代码块：放置你想要测量执行时间的代码。</li>
<li><code>let endTime = Date()</code>：记录代码执行结束的时间。</li>
<li><code>let executionTime = endTime.timeIntervalSince(startTime)</code>：计算两个时间点之间的时间差，单位是秒。</li>
<li><code>print(&quot;代码执行时间: \(executionTime) 秒&quot;)</code>：输出执行时间。</li>
</ol>
<p>这种方法适合用来测量相对较短时间的代码块执行时间。如果你需要更精确的时间测量，特别是对于需要在更小时间单位（如纳秒）内测量的场合，可以使用<code>DispatchTime</code>。</p>
<h3 id="使用-DispatchTime"><a href="#使用-DispatchTime" class="headerlink" title="使用 DispatchTime"></a>使用 <code>DispatchTime</code></h3><p><code>DispatchTime</code> 提供了更高精度的时间测量，适用于需要微秒或纳秒级别精度的情况：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> start <span class="operator">=</span> <span class="type">DispatchTime</span>.now()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里放置你想测量执行时间的代码</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span><span class="number">1000</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> end <span class="operator">=</span> <span class="type">DispatchTime</span>.now()</span><br><span class="line"><span class="keyword">let</span> nanoseconds <span class="operator">=</span> end.uptimeNanoseconds <span class="operator">-</span> start.uptimeNanoseconds</span><br><span class="line"><span class="keyword">let</span> milliseconds <span class="operator">=</span> <span class="type">Double</span>(nanoseconds) <span class="operator">/</span> <span class="number">1_000_000</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;代码执行时间: <span class="subst">\(milliseconds)</span> 毫秒&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>在这个例子中：</p>
<ol>
<li><code>let start = DispatchTime.now()</code>：记录代码开始执行的时间。</li>
<li>代码块：放置你想要测量执行时间的代码。</li>
<li><code>let end = DispatchTime.now()</code>：记录代码执行结束的时间。</li>
<li><code>let nanoseconds = end.uptimeNanoseconds - start.uptimeNanoseconds</code>：计算两个时间点之间的时间差，单位是纳秒。</li>
<li><code>let milliseconds = Double(nanoseconds) / 1_000_000</code>：将时间差转换为毫秒。</li>
<li><code>print(&quot;代码执行时间: \(milliseconds) 毫秒&quot;)</code>：输出执行时间。</li>
</ol>
<p>可以封装一个通用的函数来测量代码的执行时间。你可以使用一个闭包来传递需要测量的代码块，并在函数中计算并打印执行时间。</p>
<p>下面是一个封装好的函数示例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">func</span> <span class="title function_">measureExecutionTime</span>(<span class="params">of</span> <span class="params">closure</span>: () -&gt; <span class="type">Void</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> start <span class="operator">=</span> <span class="type">DispatchTime</span>.now()</span><br><span class="line"></span><br><span class="line">    closure()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> end <span class="operator">=</span> <span class="type">DispatchTime</span>.now()</span><br><span class="line">    <span class="keyword">let</span> nanoseconds <span class="operator">=</span> end.uptimeNanoseconds <span class="operator">-</span> start.uptimeNanoseconds</span><br><span class="line">    <span class="keyword">let</span> milliseconds <span class="operator">=</span> <span class="type">Double</span>(nanoseconds) <span class="operator">/</span> <span class="number">1_000_000</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;代码执行时间: <span class="subst">\(milliseconds)</span> 毫秒&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><p>你可以在业务代码的后面调用这个函数，并将需要测量执行时间的代码块作为闭包传递给它：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">measureExecutionTime &#123;</span><br><span class="line">    <span class="comment">// 这里放置你想测量执行时间的代码</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span><span class="operator">..&lt;</span><span class="number">1000</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="函数说明"><a href="#函数说明" class="headerlink" title="函数说明"></a>函数说明</h3><ul>
<li><code>measureExecutionTime(of closure: () -&gt; Void)</code>：该函数接受一个闭包作为参数，在闭包内编写你想要测量执行时间的代码。</li>
<li>该函数会自动测量代码的执行时间，并以毫秒为单位输出到控制台。</li>
</ul>
<p>这样你就可以方便地在任何代码块后面调用<code>measureExecutionTime</code>函数来测量执行时间了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/08/19/%E5%9C%A8SwiftUI%E4%B8%AD%E5%A6%82%E4%BD%95%E8%AE%A1%E7%AE%97%E4%BB%A3%E7%A0%81%E7%9A%84%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4%EF%BC%9F/" data-id="cm6swutiv00308q74fc36c0lc" data-title="在SwiftUI中如何计算代码的执行时间？" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-SwiftUI中的scrollTransition修饰符怎么使用？" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/08/19/SwiftUI%E4%B8%AD%E7%9A%84scrollTransition%E4%BF%AE%E9%A5%B0%E7%AC%A6%E6%80%8E%E4%B9%88%E4%BD%BF%E7%94%A8%EF%BC%9F/" class="article-date">
  <time class="dt-published" datetime="2024-08-19T00:06:26.000Z" itemprop="datePublished">2024-08-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/08/19/SwiftUI%E4%B8%AD%E7%9A%84scrollTransition%E4%BF%AE%E9%A5%B0%E7%AC%A6%E6%80%8E%E4%B9%88%E4%BD%BF%E7%94%A8%EF%BC%9F/">SwiftUI中的scrollTransition修饰符怎么使用？</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在SwiftUI中，<code>scrollTransition</code>修饰符用于在滚动视图中为视图添加基于滚动位置的动画效果。它允许你在滚动过程中为视图添加过渡效果，比如缩放、旋转、透明度变化等。<code>scrollTransition</code>修饰符通常与<code>ScrollView</code>或<code>List</code>等视图配合使用。</p>
<p>以下是<code>scrollTransition</code>修饰符的基本用法示例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ScrollTransitionExample</span>: <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ScrollView</span> &#123;</span><br><span class="line">            <span class="type">VStack</span>(spacing: <span class="number">20</span>) &#123;</span><br><span class="line">                <span class="type">ForEach</span>(<span class="number">0</span><span class="operator">..&lt;</span><span class="number">20</span>) &#123; index <span class="keyword">in</span></span><br><span class="line">                    <span class="type">Text</span>(<span class="string">&quot;Item <span class="subst">\(index)</span>&quot;</span>)</span><br><span class="line">                        .font(.largeTitle)</span><br><span class="line">                        .padding()</span><br><span class="line">                        .background(<span class="type">Color</span>.blue)</span><br><span class="line">                        .cornerRadius(<span class="number">10</span>)</span><br><span class="line">                        .scrollTransition &#123; content, phase <span class="keyword">in</span></span><br><span class="line">                            content</span><br><span class="line">                                .scaleEffect(<span class="number">1</span> <span class="operator">-</span> phase.value <span class="operator">*</span> <span class="number">0.5</span>)</span><br><span class="line">                                .rotationEffect(.degrees(phase.value <span class="operator">*</span> <span class="number">360</span>))</span><br><span class="line">                                .opacity(<span class="number">1</span> <span class="operator">-</span> phase.value)</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ScrollTransitionExample_Previews</span>: <span class="title class_">PreviewProvider</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ScrollTransitionExample</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h3><ul>
<li>**<code>scrollTransition</code>**：这个修饰符接受一个闭包，该闭包的两个参数是<code>content</code>和<code>phase</code>。<code>content</code>是你正在修饰的视图，<code>phase</code>是一个包含滚动进度信息的值。</li>
<li>**<code>phase.value</code>**：<code>phase.value</code>表示滚动过渡的进度，通常在<code>0.0</code>到<code>1.0</code>之间变化，表示从完全未滚动到完全滚动的状态。</li>
</ul>
<h3 id="过渡效果"><a href="#过渡效果" class="headerlink" title="过渡效果"></a>过渡效果</h3><p>在上述示例中，当滚动视图向上滚动时，每个<code>Text</code>视图都会：</p>
<ul>
<li><strong>缩放</strong>：根据滚动进度缩小。</li>
<li><strong>旋转</strong>：根据滚动进度旋转。</li>
<li><strong>透明度</strong>：根据滚动进度变得透明。</li>
</ul>
<p>这个效果让用户在滚动时感受到流畅的视觉过渡，提升了用户体验。你可以根据需要自定义<code>scrollTransition</code>中的动画效果。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/08/19/SwiftUI%E4%B8%AD%E7%9A%84scrollTransition%E4%BF%AE%E9%A5%B0%E7%AC%A6%E6%80%8E%E4%B9%88%E4%BD%BF%E7%94%A8%EF%BC%9F/" data-id="cm6swutiq001j8q74g03ofte3" data-title="SwiftUI中的scrollTransition修饰符怎么使用？" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-使用JavaNIO编写一个HelloWorld程序" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/17/%E4%BD%BF%E7%94%A8JavaNIO%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AAHelloWorld%E7%A8%8B%E5%BA%8F/" class="article-date">
  <time class="dt-published" datetime="2024-03-17T02:52:45.000Z" itemprop="datePublished">2024-03-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/17/%E4%BD%BF%E7%94%A8JavaNIO%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AAHelloWorld%E7%A8%8B%E5%BA%8F/">使用JavaNIO编写一个HelloWorld程序</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>以下是一个简单的 Java NIO 客户端和服务端的 “Hello World” 程序：</p>
<p><strong>服务端程序（Server.java）：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.ServerSocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SocketChannel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Server</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 创建 ServerSocketChannel</span></span><br><span class="line">            <span class="type">ServerSocketChannel</span> <span class="variable">serverSocketChannel</span> <span class="operator">=</span> ServerSocketChannel.open();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 绑定端口</span></span><br><span class="line">            serverSocketChannel.bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="number">9999</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;Server started, listening on port 9999...&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="comment">// 接受客户端连接</span></span><br><span class="line">                <span class="type">SocketChannel</span> <span class="variable">socketChannel</span> <span class="operator">=</span> serverSocketChannel.accept();</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 读取数据</span></span><br><span class="line">                <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">                socketChannel.read(buffer);</span><br><span class="line">                buffer.flip();</span><br><span class="line">                System.out.println(<span class="string">&quot;Received message from client: &quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(buffer.array()).trim());</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 发送响应</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> <span class="string">&quot;Hello Client!&quot;</span>;</span><br><span class="line">                <span class="type">ByteBuffer</span> <span class="variable">responseBuffer</span> <span class="operator">=</span> ByteBuffer.wrap(response.getBytes());</span><br><span class="line">                socketChannel.write(responseBuffer);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 关闭连接</span></span><br><span class="line">                socketChannel.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>客户端程序（Client.java）：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SocketChannel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 创建 SocketChannel</span></span><br><span class="line">            <span class="type">SocketChannel</span> <span class="variable">socketChannel</span> <span class="operator">=</span> SocketChannel.open();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 连接到服务器</span></span><br><span class="line">            socketChannel.connect(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="string">&quot;localhost&quot;</span>, <span class="number">9999</span>));</span><br><span class="line">            System.out.println(<span class="string">&quot;Connected to server...&quot;</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 发送数据</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;Hello Server!&quot;</span>;</span><br><span class="line">            <span class="type">ByteBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> ByteBuffer.wrap(message.getBytes());</span><br><span class="line">            socketChannel.write(buffer);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 接收响应</span></span><br><span class="line">            <span class="type">ByteBuffer</span> <span class="variable">responseBuffer</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">            socketChannel.read(responseBuffer);</span><br><span class="line">            responseBuffer.flip();</span><br><span class="line">            System.out.println(<span class="string">&quot;Received response from server: &quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(responseBuffer.array()).trim());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 关闭连接</span></span><br><span class="line">            socketChannel.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个程序包括一个简单的客户端和服务器端。服务器监听端口9999，并在接收到客户端消息后，返回 “Hello Client!”。客户端连接到服务器，发送消息 “Hello Server!”，并打印出从服务器接收到的响应。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/17/%E4%BD%BF%E7%94%A8JavaNIO%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AAHelloWorld%E7%A8%8B%E5%BA%8F/" data-id="cm6swutiu002u8q745xry9dcw" data-title="使用JavaNIO编写一个HelloWorld程序" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Docker部署xxl-job-admin步骤" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/14/Docker%E9%83%A8%E7%BD%B2xxl-job-admin%E6%AD%A5%E9%AA%A4/" class="article-date">
  <time class="dt-published" datetime="2024-03-14T05:09:17.000Z" itemprop="datePublished">2024-03-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/14/Docker%E9%83%A8%E7%BD%B2xxl-job-admin%E6%AD%A5%E9%AA%A4/">用 Docker 部署 xxl-job 简明指南</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在现代开发环境中，使用 Docker 进行部署已成为标准实践之一。xxl-job 作为一个基于 MySQL 的任务调度平台，在部署时也可以充分利用 Docker 的便利性。本文将指导您如何使用 Docker 在本地部署 xxl-job 项目。</p>
<h3 id="1-下载-MySQL-镜像"><a href="#1-下载-MySQL-镜像" class="headerlink" title="1. 下载 MySQL 镜像"></a>1. 下载 MySQL 镜像</h3><p>首先，由于 xxl-job 依赖 MySQL 数据库，我们需要先下载 MySQL 的 Docker 镜像：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql:latest</span><br></pre></td></tr></table></figure>

<h3 id="2-创建自定义网络"><a href="#2-创建自定义网络" class="headerlink" title="2. 创建自定义网络"></a>2. 创建自定义网络</h3><p>为了使 MySQL 容器和 xxl-job-admin 容器能够相互通信，我们需要创建一个自定义网络。执行以下命令创建名为 <code>my_net</code> 的自定义网络：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create my_net</span><br></pre></td></tr></table></figure>

<h3 id="3-启动-MySQL-容器"><a href="#3-启动-MySQL-容器" class="headerlink" title="3. 启动 MySQL 容器"></a>3. 启动 MySQL 容器</h3><p>使用以下命令启动 MySQL 容器，确保先下载了 MySQL 镜像：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 3306:3306 \</span><br><span class="line">--name mysql \</span><br><span class="line">-v /Users/xiaozhang/v_docker_mysql/conf:/etc/mysql/conf.d \</span><br><span class="line">-v /Users/xiaozhang/v_docker_mysql/data:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=your_root_password \</span><br><span class="line">--network my_net \</span><br><span class="line">-d mysql</span><br></pre></td></tr></table></figure>

<p>请将 <code>your_root_password</code> 替换为您的 MySQL ROOT 用户的密码。</p>
<h3 id="4-执行-xxl-job-数据库脚本"><a href="#4-执行-xxl-job-数据库脚本" class="headerlink" title="4. 执行 xxl-job 数据库脚本"></a>4. 执行 xxl-job 数据库脚本</h3><p>使用数据库客户端工具连接到上一步启动的 MySQL 数据库，并执行 xxl-job-admin 项目提供的 <code>tables_xxl_job.sql</code> 脚本。该脚本将创建名为 <code>xxl-job</code> 的数据库并初始化所需的数据。</p>
<p>连接信息如下：</p>
<ul>
<li>主机地址：localhost</li>
<li>端口：3306</li>
<li>用户名：root</li>
<li>密码：您的 MySQL ROOT 用户的密码</li>
</ul>
<h3 id="5-启动-xxl-job-admin"><a href="#5-启动-xxl-job-admin" class="headerlink" title="5. 启动 xxl-job-admin"></a>5. 启动 xxl-job-admin</h3><p>现在，我们可以启动 xxl-job-admin 了。执行以下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">-e PARAMS=&quot;--spring.datasource.url=jdbc:mysql://mysql:3306/xxl_job?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai --spring.datasource.username=root --spring.datasource.password=your_database_password&quot; \</span><br><span class="line">-p 8080:8080 \</span><br><span class="line">-v /Users/xiaozhang/logs:/data/applogs \</span><br><span class="line">--network=my_net \</span><br><span class="line">--name xxl-job-admin \</span><br><span class="line">-d xuxueli/xxl-job-admin:2.4.0</span><br></pre></td></tr></table></figure>

<p>请将 <code>your_database_password</code> 替换为您的数据库密码。</p>
<h3 id="6-访问-xxl-job-admin"><a href="#6-访问-xxl-job-admin" class="headerlink" title="6. 访问 xxl-job-admin"></a>6. 访问 xxl-job-admin</h3><p>打开浏览器，并访问：<a target="_blank" rel="noopener" href="http://localhost:8080/xxl-job-admin/">http://localhost:8080/xxl-job-admin/</a></p>
<p>默认登录用户名为：admin<br>默认登录密码为：123456</p>
<h3 id="一键部署脚本：docker-compose-yml"><a href="#一键部署脚本：docker-compose-yml" class="headerlink" title="一键部署脚本：docker-compose.yml"></a>一键部署脚本：docker-compose.yml</h3><p>如果觉得上面的步骤繁琐，使用下面的<code>docker compose</code>脚本，可以实现一键部署。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.7&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;13306:3306&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./conf:/etc/mysql/conf.d</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./mysql_data:/var/lib/mysql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./sql:/docker-entrypoint-initdb.d</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">your_mysql_root_password</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">my_net</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">xxl-job-admin:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">xuxueli/xxl-job-admin:2.4.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">xxl-job-admin</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">PARAMS:</span> <span class="string">&quot;--spring.datasource.url=jdbc:mysql://mysql:3306/xxl_job?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai --spring.datasource.username=root --spring.datasource.password=your_mysql_root_password&quot;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;18080:8080&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/Users/xiaozhang/logs:/data/applogs</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">my_net</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">my_net:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></table></figure>
<p>要执行这个 <code>docker-compose.yml</code> 脚本，您需要使用 <code>docker-compose</code> 命令，在命令行中，进入包含 <code>docker-compose.yml</code> 文件的目录。运行以下命令启动服务：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<p>通过 <code>-d</code> 参数，您可以将服务在后台运行。如果您想要查看服务输出的日志信息，可以省略 <code>-d</code> 参数。</p>
<p>下面解释一下这个脚本，该脚本包含了<code>mysql</code>和<code>xxl-job-admin</code>两个服务：</p>
<ol>
<li><p><strong>mysql 服务</strong>：</p>
<ul>
<li>使用官方提供的最新版本 MySQL 镜像。</li>
<li>定义容器名称为 <code>mysql</code>。</li>
<li>将宿主机的 <code>3306</code> 端口映射到容器的 <code>3306</code> 端口，允许外部访问 MySQL 服务。</li>
<li>将宿主机的 MySQL 配置文件和数据目录挂载到容器中，以保留持久化数据。</li>
<li>设置 MySQL ROOT 用户的密码为 <code>your_root_password</code>。</li>
<li>将容器连接到名为 <code>my_net</code> 的自定义网络中。</li>
</ul>
</li>
<li><p><strong>xxl-job-admin 服务</strong>：</p>
<ul>
<li>使用 xxl-job-admin 2.4.0 版本的镜像。</li>
<li>定义容器名称为 <code>xxl-job-admin</code>。</li>
<li>设置 xxl-job-admin 启动时的参数，包括连接到 MySQL 数据库所需的信息，以及其他必要的配置。</li>
<li>将宿主机的 <code>8080</code> 端口映射到容器的 <code>8080</code> 端口，允许外部访问 xxl-job-admin。</li>
<li>将宿主机的日志目录挂载到容器中，以便记录日志和持久化数据。</li>
<li>将容器连接到名为 <code>my_net</code> 的自定义网络中。</li>
</ul>
</li>
</ol>
<p>最后，定义了一个名为 <code>my_net</code> 的自定义网络，并使用 <code>bridge</code> 驱动。此网络用于连接上述两个服务，以实现它们之间的通信。</p>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol>
<li>确保 MySQL 容器和 xxl-job-admin 容器使用同一个自定义网络，否则 xxl-job-admin 将无法连接 MySQL 数据库而启动失败。</li>
<li>由于<code>xxl-job-admin</code>依赖<code>mysql</code>服务，所以要先启动<code>mysql</code>服务，然后再启动<code>xxl-job-admin</code>服务。</li>
<li>在启动 xxl-job-admin 容器时，注意指定 MySQL 数据库的连接信息。连接地址应为容器名称 <code>mysql</code>，且数据库密码应与启动 MySQL 容器时使用的 ROOT 用户密码保持一致。</li>
<li>确保宿主机的 <code>3306</code> 端口和 <code>8080</code> 端口未被占用，否则容器启动将失败。</li>
<li>如果在启动 xxl-job-admin 容器时挂载了宿主机上的目录（例如 <code>/Users/xiaozhang/logs</code>），请确保在 MacOS 操作系统上手动创建这些目录，以避免由于目录权限问题导致容器无法启动的情况。</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/03/14/Docker%E9%83%A8%E7%BD%B2xxl-job-admin%E6%AD%A5%E9%AA%A4/" data-id="cm6swutie00008q74coyf11hw" data-title="用 Docker 部署 xxl-job 简明指南" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-在Mac上如何终止某个端口所在的进程？" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/12/%E5%9C%A8Mac%E4%B8%8A%E5%A6%82%E4%BD%95%E7%BB%88%E6%AD%A2%E6%9F%90%E4%B8%AA%E7%AB%AF%E5%8F%A3%E6%89%80%E5%9C%A8%E7%9A%84%E8%BF%9B%E7%A8%8B%EF%BC%9F/" class="article-date">
  <time class="dt-published" datetime="2023-11-12T03:31:14.000Z" itemprop="datePublished">2023-11-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/12/%E5%9C%A8Mac%E4%B8%8A%E5%A6%82%E4%BD%95%E7%BB%88%E6%AD%A2%E6%9F%90%E4%B8%AA%E7%AB%AF%E5%8F%A3%E6%89%80%E5%9C%A8%E7%9A%84%E8%BF%9B%E7%A8%8B%EF%BC%9F/">在Mac上如何终止某个端口所在的进程？</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在Mac上终止占用特定端口的进程可以通过以下步骤来完成：</p>
<ol>
<li><p><strong>查找占用端口的进程</strong>：<br>打开终端（Terminal），然后使用<code>lsof</code>命令来查找占用特定端口的进程。例如，如果你想查找占用端口8080的进程，可以使用以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -i :8080</span><br></pre></td></tr></table></figure>

<p>这将列出所有占用端口8080的进程。输出中通常会包含进程ID（PID），这是一个数字。</p>
</li>
<li><p><strong>终止进程</strong>：<br>一旦你知道了进程ID，可以使用<code>kill</code>命令来终止该进程。例如，如果进程ID是1234，可以使用以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> 1234</span><br></pre></td></tr></table></figure>

<p>如果进程拒绝终止，你可以使用更强制的方式，比如<code>kill -9</code>命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -9 1234</span><br></pre></td></tr></table></figure>

<p>这将强制终止该进程。</p>
</li>
</ol>
<p>请注意，在使用这些命令时要小心，确保你终止的是正确的进程，因为错误地终止进程可能会影响系统的稳定性或其他应用的运行。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/12/%E5%9C%A8Mac%E4%B8%8A%E5%A6%82%E4%BD%95%E7%BB%88%E6%AD%A2%E6%9F%90%E4%B8%AA%E7%AB%AF%E5%8F%A3%E6%89%80%E5%9C%A8%E7%9A%84%E8%BF%9B%E7%A8%8B%EF%BC%9F/" data-id="cm6swutiv00328q748q76d8b7" data-title="在Mac上如何终止某个端口所在的进程？" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mac/" rel="tag">Mac</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Java实现两台计算机之间长连接通信" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/09/Java%E5%AE%9E%E7%8E%B0%E4%B8%A4%E5%8F%B0%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%B9%8B%E9%97%B4%E9%95%BF%E8%BF%9E%E6%8E%A5%E9%80%9A%E4%BF%A1/" class="article-date">
  <time class="dt-published" datetime="2023-11-09T12:54:10.000Z" itemprop="datePublished">2023-11-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/09/Java%E5%AE%9E%E7%8E%B0%E4%B8%A4%E5%8F%B0%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%B9%8B%E9%97%B4%E9%95%BF%E8%BF%9E%E6%8E%A5%E9%80%9A%E4%BF%A1/">Java实现两台计算机之间长连接通信</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>要实现客户端和服务器端的长连接，即一直保持连接直到程序显式关闭，你可以在客户端和服务器端都使用循环来持续地发送和接收消息。下面是相应的代码示例：</p>
<h3 id="服务器端（B计算机）"><a href="#服务器端（B计算机）" class="headerlink" title="服务器端（B计算机）"></a>服务器端（B计算机）</h3><p>服务器端持续监听客户端发送的消息。使用<code>while(true)</code>确保服务器始终在运行，等待和处理客户端的消息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Server</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> <span class="number">1234</span>;</span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">serverSocket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(port);</span><br><span class="line">        System.out.println(<span class="string">&quot;等待连接...&quot;</span>);</span><br><span class="line">        <span class="type">Socket</span> <span class="variable">clientSocket</span> <span class="operator">=</span> serverSocket.accept();</span><br><span class="line">        System.out.println(<span class="string">&quot;连接成功！&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(clientSocket.getInputStream()));</span><br><span class="line"></span><br><span class="line">        String inputLine;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123; <span class="comment">// 一直保持监听状态</span></span><br><span class="line">            inputLine = in.readLine();</span><br><span class="line">            <span class="keyword">if</span> (inputLine != <span class="literal">null</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;收到: &quot;</span> + inputLine);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 注意：实际应用中需要添加适当的退出条件和异常处理</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="客户端（A计算机）"><a href="#客户端（A计算机）" class="headerlink" title="客户端（A计算机）"></a>客户端（A计算机）</h3><p>客户端持续发送消息到服务器。在这个例子中，我们仅以发送时间作为消息的示例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">serverAddress</span> <span class="operator">=</span> <span class="string">&quot;服务器的IP地址&quot;</span>; <span class="comment">// 替换为B计算机的IP地址</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> <span class="number">1234</span>;</span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(serverAddress, port);</span><br><span class="line"></span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintWriter</span>(socket.getOutputStream(), <span class="literal">true</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123; <span class="comment">// 一直发送消息</span></span><br><span class="line">            out.println(<span class="string">&quot;当前时间: &quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>); <span class="comment">// 每秒发送一次</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 注意：实际应用中需要添加适当的退出条件和异常处理</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这两个示例中，我没有添加退出条件和异常处理，但这在实际应用中是非常重要的。你需要确保代码能够优雅地处理网络异常、I&#x2F;O异常以及如何安全地关闭连接。记住，长时间保持连接会增加资源消耗，确保服务器有足够的资源来处理这些长连接。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/09/Java%E5%AE%9E%E7%8E%B0%E4%B8%A4%E5%8F%B0%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%B9%8B%E9%97%B4%E9%95%BF%E8%BF%9E%E6%8E%A5%E9%80%9A%E4%BF%A1/" data-id="cm6swutij00048q74ebco56tf" data-title="Java实现两台计算机之间长连接通信" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/BufferedReader/" rel="tag">BufferedReader</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/InputStreamReader/" rel="tag">InputStreamReader</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PrintWriter/" rel="tag">PrintWriter</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ServerSocket/" rel="tag">ServerSocket</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Socket/" rel="tag">Socket</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Java实现两台计算机之间的简单通信" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/09/Java%E5%AE%9E%E7%8E%B0%E4%B8%A4%E5%8F%B0%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%B9%8B%E9%97%B4%E7%9A%84%E7%AE%80%E5%8D%95%E9%80%9A%E4%BF%A1/" class="article-date">
  <time class="dt-published" datetime="2023-11-09T12:41:22.000Z" itemprop="datePublished">2023-11-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/09/Java%E5%AE%9E%E7%8E%B0%E4%B8%A4%E5%8F%B0%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%B9%8B%E9%97%B4%E7%9A%84%E7%AE%80%E5%8D%95%E9%80%9A%E4%BF%A1/">Java实现两台计算机之间的简单通信</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>要在Java中实现从一台计算机（A）向另一台计算机（B）发送数据，你可以使用Java的套接字编程。这通常涉及到创建服务器端和客户端程序。服务器在B计算机上运行，监听一个端口等待连接；客户端运行在A计算机上，连接到服务器并发送数据。</p>
<p>这里是一个简单的示例：</p>
<h3 id="服务器端（在B计算机上运行）"><a href="#服务器端（在B计算机上运行）" class="headerlink" title="服务器端（在B计算机上运行）"></a>服务器端（在B计算机上运行）</h3><ol>
<li>创建<code>ServerSocket</code>对象并指定一个端口。</li>
<li>调用<code>accept</code>方法等待客户端连接。</li>
<li>通过建立的连接读取数据。</li>
<li>关闭连接。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Server</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> <span class="number">1234</span>; <span class="comment">// 选择一个端口</span></span><br><span class="line">        <span class="type">ServerSocket</span> <span class="variable">serverSocket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServerSocket</span>(port);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;等待连接...&quot;</span>);</span><br><span class="line">        <span class="type">Socket</span> <span class="variable">clientSocket</span> <span class="operator">=</span> serverSocket.accept();</span><br><span class="line">        System.out.println(<span class="string">&quot;连接成功！&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(clientSocket.getInputStream()));</span><br><span class="line">        String inputLine;</span><br><span class="line">        <span class="keyword">while</span> ((inputLine = in.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;收到: &quot;</span> + inputLine);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        in.close();</span><br><span class="line">        clientSocket.close();</span><br><span class="line">        serverSocket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="客户端（在A计算机上运行）"><a href="#客户端（在A计算机上运行）" class="headerlink" title="客户端（在A计算机上运行）"></a>客户端（在A计算机上运行）</h3><ol>
<li>创建<code>Socket</code>对象，指定服务器地址和端口。</li>
<li>获取输出流并发送数据。</li>
<li>关闭连接。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">serverAddress</span> <span class="operator">=</span> <span class="string">&quot;服务器的IP地址&quot;</span>; <span class="comment">// 替换为B计算机的IP地址</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> <span class="number">1234</span>;</span><br><span class="line">        <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(serverAddress, port);</span><br><span class="line"></span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintWriter</span>(socket.getOutputStream(), <span class="literal">true</span>);</span><br><span class="line">        out.println(<span class="string">&quot;你好，服务器！&quot;</span>);</span><br><span class="line"></span><br><span class="line">        out.close();</span><br><span class="line">        socket.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ul>
<li>请确保服务器和客户端使用相同的端口号。</li>
<li>需要处理网络异常和I&#x2F;O异常。</li>
<li>根据你的网络设置，你可能需要配置防火墙允许这些端口的通信。</li>
<li>在实际应用中，还需要考虑安全性和效率等问题。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/11/09/Java%E5%AE%9E%E7%8E%B0%E4%B8%A4%E5%8F%B0%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%B9%8B%E9%97%B4%E7%9A%84%E7%AE%80%E5%8D%95%E9%80%9A%E4%BF%A1/" data-id="cm6swutih00028q7431728qch" data-title="Java实现两台计算机之间的简单通信" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ServerSocket/" rel="tag">ServerSocket</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Socket/" rel="tag">Socket</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SwiftUI/">SwiftUI</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/BufferedReader/" rel="tag">BufferedReader</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/InputStreamReader/" rel="tag">InputStreamReader</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mac/" rel="tag">Mac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PrintWriter/" rel="tag">PrintWriter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ServerSocket/" rel="tag">ServerSocket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Socket/" rel="tag">Socket</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/BufferedReader/" style="font-size: 10px;">BufferedReader</a> <a href="/tags/InputStreamReader/" style="font-size: 10px;">InputStreamReader</a> <a href="/tags/Mac/" style="font-size: 10px;">Mac</a> <a href="/tags/PrintWriter/" style="font-size: 10px;">PrintWriter</a> <a href="/tags/ServerSocket/" style="font-size: 20px;">ServerSocket</a> <a href="/tags/Socket/" style="font-size: 20px;">Socket</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/02/">February 2025</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/10/">October 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/02/06/25%E5%B9%B4%E5%89%8D%E4%B8%AD%E5%A4%AE%E7%94%B5%E8%A7%86%E5%8F%B0%E5%B9%BF%E5%91%8A%E6%8A%A5%E4%BB%B7/">25年前中央电视台广告报价</a>
          </li>
        
          <li>
            <a href="/2025/02/06/%E8%AE%A1%E7%AE%97%E6%9C%BA%E9%A2%86%E5%9F%9F%E7%9A%84%E7%AE%97%E6%B3%95/">计算机领域的算法</a>
          </li>
        
          <li>
            <a href="/2024/10/28/%E5%9C%A8%20SwiftUI%20%E4%B8%AD%E6%9E%84%E5%BB%BA%E7%85%A7%E7%89%87%E5%BA%93%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/">(no title)</a>
          </li>
        
          <li>
            <a href="/2024/08/19/%E5%9C%A8SwiftUI%E4%B8%AD%E5%A6%82%E4%BD%95%E8%AE%A1%E7%AE%97%E4%BB%A3%E7%A0%81%E7%9A%84%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4%EF%BC%9F/">在SwiftUI中如何计算代码的执行时间？</a>
          </li>
        
          <li>
            <a href="/2024/08/19/SwiftUI%E4%B8%AD%E7%9A%84scrollTransition%E4%BF%AE%E9%A5%B0%E7%AC%A6%E6%80%8E%E4%B9%88%E4%BD%BF%E7%94%A8%EF%BC%9F/">SwiftUI中的scrollTransition修饰符怎么使用？</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>